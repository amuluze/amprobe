import"./el-button.Bf-OVv06.js";import{v as e}from"./el-loading.8LoI83hF.js";import{E as a}from"./el-progress.BTXYu3w2.js";import{E as t}from"./el-dialog.lvghXYgZ.js";import{e as l,s as r}from"./message.ohA7tZs1.js";import{E as i,a as o}from"./el-table-column.ROcqc2dJ.js";import"./el-tooltip.l0sNRNKZ.js";import"./el-popper.Cq1hAJs-.js";/* empty css               */import{E as n}from"./el-card.vZ36OKf6.js";import{E as s,a as d,b as u}from"./el-dropdown-item.A4tYUKUb.js";import{_ as c}from"./index.DcE9Scjy.js";import{h as f,i as m,j as p,k as h,l as v}from"./index.DyaXtYK0.js";import{d as g,y as _,r as y,o as j,k as b,f as C,m as w,w as x,u as k,X as A,F as V,a as z,A as E,e as O,b as T,i as U,t as Y,R as $,S as D,_ as R}from"./index.Dtsxs5-j.js";import{c as I}from"./convert.B8xZ5nZn.js";import{g as S,d as B}from"./dayjs.min.BglOJP2w.js";import{E as F,a as H}from"./index.7fU9QC-V.js";import{E as J}from"./index.eDhpYl8G.js";import"./index.DhER-06O.js";import"./_baseClone.Cjz58nAh.js";import"./_Uint8Array.DZ6GMUyG.js";import"./_initCloneObject.L1lxMjk_.js";import"./isEqual.DXE01s-J.js";import"./use-dialog.CS3h8_eu.js";import"./vnode.C8vko7L8.js";import"./event.BwRzfsZt.js";import"./use-form-item.vgwZ2Rnc.js";import"./scroll.BeZ43HJL.js";import"./focus-trap.BiItK6l-.js";import"./refs.VtWbXh-B.js";import"./castArray.B6kcHc-f.js";import"./index.Ct-vKfEQ.js";function L(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function M(e,a){for(var t,l="",r=0,i=-1,o=0,n=0;n<=e.length;++n){if(n<e.length)t=e.charCodeAt(n);else{if(47===t)break;t=47}if(47===t){if(i===n-1||1===o);else if(i!==n-1&&2===o){if(l.length<2||2!==r||46!==l.charCodeAt(l.length-1)||46!==l.charCodeAt(l.length-2))if(l.length>2){var s=l.lastIndexOf("/");if(s!==l.length-1){-1===s?(l="",r=0):r=(l=l.slice(0,s)).length-1-l.lastIndexOf("/"),i=n,o=0;continue}}else if(2===l.length||1===l.length){l="",r=0,i=n,o=0;continue}a&&(l.length>0?l+="/..":l="..",r=2)}else l.length>0?l+="/"+e.slice(i+1,n):l=e.slice(i+1,n),r=n-i-1;i=n,o=0}else 46===t&&-1!==o?++o:o=-1}return l}var N={resolve:function(){for(var e,a="",t=!1,l=arguments.length-1;l>=-1&&!t;l--){var r;l>=0?r=arguments[l]:(void 0===e&&(e=process.cwd()),r=e),L(r),0!==r.length&&(a=r+"/"+a,t=47===r.charCodeAt(0))}return a=M(a,!t),t?a.length>0?"/"+a:"/":a.length>0?a:"."},normalize:function(e){if(L(e),0===e.length)return".";var a=47===e.charCodeAt(0),t=47===e.charCodeAt(e.length-1);return 0!==(e=M(e,!a)).length||a||(e="."),e.length>0&&t&&(e+="/"),a?"/"+e:e},isAbsolute:function(e){return L(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,a=0;a<arguments.length;++a){var t=arguments[a];L(t),t.length>0&&(void 0===e?e=t:e+="/"+t)}return void 0===e?".":N.normalize(e)},relative:function(e,a){if(L(e),L(a),e===a)return"";if((e=N.resolve(e))===(a=N.resolve(a)))return"";for(var t=1;t<e.length&&47===e.charCodeAt(t);++t);for(var l=e.length,r=l-t,i=1;i<a.length&&47===a.charCodeAt(i);++i);for(var o=a.length-i,n=r<o?r:o,s=-1,d=0;d<=n;++d){if(d===n){if(o>n){if(47===a.charCodeAt(i+d))return a.slice(i+d+1);if(0===d)return a.slice(i+d)}else r>n&&(47===e.charCodeAt(t+d)?s=d:0===d&&(s=0));break}var u=e.charCodeAt(t+d);if(u!==a.charCodeAt(i+d))break;47===u&&(s=d)}var c="";for(d=t+s+1;d<=l;++d)d!==l&&47!==e.charCodeAt(d)||(0===c.length?c+="..":c+="/..");return c.length>0?c+a.slice(i+s):(i+=s,47===a.charCodeAt(i)&&++i,a.slice(i))},_makeLong:function(e){return e},dirname:function(e){if(L(e),0===e.length)return".";for(var a=e.charCodeAt(0),t=47===a,l=-1,r=!0,i=e.length-1;i>=1;--i)if(47===(a=e.charCodeAt(i))){if(!r){l=i;break}}else r=!1;return-1===l?t?"/":".":t&&1===l?"//":e.slice(0,l)},basename:function(e,a){if(void 0!==a&&"string"!=typeof a)throw new TypeError('"ext" argument must be a string');L(e);var t,l=0,r=-1,i=!0;if(void 0!==a&&a.length>0&&a.length<=e.length){if(a.length===e.length&&a===e)return"";var o=a.length-1,n=-1;for(t=e.length-1;t>=0;--t){var s=e.charCodeAt(t);if(47===s){if(!i){l=t+1;break}}else-1===n&&(i=!1,n=t+1),o>=0&&(s===a.charCodeAt(o)?-1==--o&&(r=t):(o=-1,r=n))}return l===r?r=n:-1===r&&(r=e.length),e.slice(l,r)}for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!i){l=t+1;break}}else-1===r&&(i=!1,r=t+1);return-1===r?"":e.slice(l,r)},extname:function(e){L(e);for(var a=-1,t=0,l=-1,r=!0,i=0,o=e.length-1;o>=0;--o){var n=e.charCodeAt(o);if(47!==n)-1===l&&(r=!1,l=o+1),46===n?-1===a?a=o:1!==i&&(i=1):-1!==a&&(i=-1);else if(!r){t=o+1;break}}return-1===a||-1===l||0===i||1===i&&a===l-1&&a===t+1?"":e.slice(a,l)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,a){var t=a.dir||a.root,l=a.base||(a.name||"")+(a.ext||"");return t?t===a.root?t+l:t+e+l:l}("/",e)},parse:function(e){L(e);var a={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return a;var t,l=e.charCodeAt(0),r=47===l;r?(a.root="/",t=1):t=0;for(var i=-1,o=0,n=-1,s=!0,d=e.length-1,u=0;d>=t;--d)if(47!==(l=e.charCodeAt(d)))-1===n&&(s=!1,n=d+1),46===l?-1===i?i=d:1!==u&&(u=1):-1!==i&&(u=-1);else if(!s){o=d+1;break}return-1===i||-1===n||0===u||1===u&&i===n-1&&i===o+1?-1!==n&&(a.base=a.name=0===o&&r?e.slice(1,n):e.slice(o,n)):(0===o&&r?(a.name=e.slice(1,i),a.base=e.slice(1,n)):(a.name=e.slice(o,i),a.base=e.slice(o,n)),a.ext=e.slice(i,n)),o>0?a.dir=e.slice(0,o-1):r&&(a.dir="/"),a},sep:"/",delimiter:":",win32:null,posix:null};N.posix=N;const X=S(N),q={class:"am-host-header"},G={class:"am-host-operator"},K={class:"am-table"},P={style:{display:"flex","align-items":"center"}},Q=["onClick"],W={class:"am-host-file-create"},Z={class:"am-host-file-create"},ee={class:"am-host-file-upload"},ae=(e=>($("data-v-abe1196b"),e=e(),D(),e))((()=>C("div",{class:"el-upload__text"},[E("Drop file here or "),C("em",null,"click to upload")],-1))),te=R(g({__name:"index",setup(g){const $=_(),D=y(!1),R=y(""),S=y(""),L=y([]);j((()=>{te(R.value,!0)}));const M=()=>{if("/"==R.value)return;S.value=R.value;let e=R.value.split("/");e.pop(),te(e.join("/"),!0)},N=()=>{"/"!=R.value&&te(S.value,!0)},te=async(e,a)=>{if(!a)return void l("该路径不是文件夹");""==e&&(e="/"),D.value=!0,R.value=e;let t={path:e};const{data:r}=await f(t);L.value=r.files,L.value.sort(((e,a)=>e.is_dir&&!a.is_dir?-1:!e.is_dir&&a.is_dir?1:0)),D.value=!1},le=y(0),re=y(!1),ie=()=>{r("上传成功"),re.value=!1,te(R.value,!0)},oe=y(!1),ne=y(!1),se=y(""),de=async()=>{const e={path:R.value,folder_name:se.value},{data:a}=await h(e);r("创建成功"),ne.value=!1,te(R.value,!0)},ue=y(!1),ce=y(""),fe=async()=>{const e={path:R.value,file_name:ce.value},{data:a}=await v(e);r("创建成功"),ue.value=!1,te(R.value,!0)};return(l,f)=>{const h=c,v=F,g=H,_=s,y=d,j=u,S=n,me=i,pe=o,he=J,ve=t,ge=a,_e=e;return z(),b(V,null,[C("div",q,[C("span",{onClick:f[0]||(f[0]=e=>l.$router.push("/host/monitor"))},"监控"),C("span",{onClick:f[1]||(f[1]=e=>l.$router.push("/host/file"))},"文件"),C("span",{onClick:f[2]||(f[2]=e=>l.$router.push("/host/settings"))},"设置")]),C("div",G,[w(S,{shadow:"never"},{default:x((()=>[w(g,{class:"ml-4",style:{"margin-right":"16px"}},{default:x((()=>[w(v,{type:"primary",plain:"",onClick:M},{default:x((()=>[w(h,{"icon-class":"back"})])),_:1}),w(v,{type:"primary",plain:"",onClick:N},{default:x((()=>[w(h,{"icon-class":"next"})])),_:1})])),_:1}),w(j,null,{dropdown:x((()=>[w(y,null,{default:x((()=>[w(_,null,{default:x((()=>[w(v,{type:"primary",size:"small",text:"",onClick:f[3]||(f[3]=e=>ne.value=!0)},{default:x((()=>[w(h,{"icon-class":"folder",style:{"margin-right":"4px"}}),E(" 文件夹 ")])),_:1})])),_:1}),w(_,null,{default:x((()=>[w(v,{type:"primary",size:"small",text:"",onClick:f[4]||(f[4]=e=>ue.value=!0)},{default:x((()=>[w(h,{"icon-class":"file",style:{"margin-right":"4px"}}),E(" 文件 ")])),_:1})])),_:1})])),_:1})])),default:x((()=>[w(v,{type:"primary",plain:""},{default:x((()=>[E(" 新建 "),w(h,{"icon-class":"down"})])),_:1})])),_:1}),w(v,{type:"primary",plain:"",onClick:f[5]||(f[5]=e=>re.value=!0)},{default:x((()=>[E(" 上传 ")])),_:1})])),_:1})]),w(S,{shadow:"never"},{default:x((()=>[C("div",K,[O((z(),T(pe,{data:k(L),key:k(le),stripe:"",ref:"multipleTable"},{default:x((()=>[w(me,{type:"selection",width:"55"}),w(me,{prop:"name",label:"名称","min-width":"150",align:"center",fixed:""},{default:x((e=>[C("div",P,[1==e.row.is_dir?(z(),T(h,{key:0,"icon-class":"folder",style:{color:"#105eeb","margin-right":"4px"}})):U("",!0),0==e.row.is_dir?(z(),T(h,{key:1,"icon-class":"file",style:{color:"#105eeb","margin-right":"4px"}})):U("",!0),C("span",{onClick:a=>te(k(X).join(k(R),e.row.name),e.row.is_dir)},Y(e.row.name),9,Q)])])),_:1}),w(me,{prop:"size",label:"大小",align:"center","min-width":"100",sortable:""},{default:x((e=>[C("span",null,Y(k(I)(e.row.size)),1)])),_:1}),w(me,{prop:"mode",label:"权限",align:"center","min-width":"100"}),w(me,{prop:"mod_time",label:"修改时间",align:"center","min-width":"100"},{default:x((e=>[C("span",null,Y(k(B)(1e3*e.row.mod_time).format("YYYY-MM-DD HH:mm:ss")),1)])),_:1}),w(me,{label:"操作",width:"200",fixed:"right",align:"center"},{default:x((e=>[w(v,{type:"danger",size:"small",text:"",onClick:a=>(async e=>{const a={filepath:X.join(R.value,e)},{data:t}=await m(a);r("删除成功"),te(R.value,!0)})(e.row.name)},{default:x((()=>[E(" 删除 ")])),_:2},1032,["onClick"]),w(v,{type:"primary",size:"small",text:"",onClick:a=>(async e=>{const a={filepath:X.join(R.value,e)},{data:t}=await p(a);r("下载成功")})(e.row.name)},{default:x((()=>[E(" 下载 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[_e,k(D)]])])])),_:1}),C("div",W,[w(ve,{modelValue:k(ue),"onUpdate:modelValue":f[7]||(f[7]=e=>A(ue)?ue.value=e:null),title:"新建文件",width:"50%"},{default:x((()=>[w(he,{modelValue:k(ce),"onUpdate:modelValue":f[6]||(f[6]=e=>A(ce)?ce.value=e:null),placeholder:"请输入文件名"},null,8,["modelValue"]),O((z(),T(v,{size:"default",type:"info",plain:"",onClick:fe},{default:x((()=>[E(" 确定 ")])),_:1})),[[_e,k(oe)]])])),_:1},8,["modelValue"])]),C("div",Z,[w(ve,{modelValue:k(ne),"onUpdate:modelValue":f[9]||(f[9]=e=>A(ne)?ne.value=e:null),title:"新建文件夹",width:"50%"},{default:x((()=>[w(he,{modelValue:k(se),"onUpdate:modelValue":f[8]||(f[8]=e=>A(se)?se.value=e:null),placeholder:"请输入文件夹名称"},null,8,["modelValue"]),O((z(),T(v,{size:"default",type:"info",plain:"",onClick:de},{default:x((()=>[E(" 确定 ")])),_:1})),[[_e,k(oe)]])])),_:1},8,["modelValue"])]),C("div",ee,[w(ve,{modelValue:k(re),"onUpdate:modelValue":f[10]||(f[10]=e=>A(re)?re.value=e:null),title:"上传文件",width:"50%"},{default:x((()=>[w(ge,{ref:"uploadRef",drag:"",action:"/app/api/v1/host/file_upload",limit:1,data:{prefix:k(R)},multiple:"",headers:{Authorization:`Bearer ${k($).user.token}`},"on-success":ie},{default:x((()=>[w(h,{"icon-class":"upload"}),ae])),_:1},8,["data","headers"])])),_:1},8,["modelValue"])])],64)}}}),[["__scopeId","data-v-abe1196b"]]);export{te as default};

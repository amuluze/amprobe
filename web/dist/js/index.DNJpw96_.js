var e=Object.defineProperty,l=(l,a,t)=>((l,a,t)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t)(l,"symbol"!=typeof a?a+"":a,t);import"./el-button.C1j4FqZl.js";import{v as a}from"./el-loading.DmBBNHrq.js";import{E as t}from"./el-drawer.BO2ebL83.js";import{a as o,e as n,s}from"./message.DTIviPtt.js";import{a as r,E as i}from"./el-form-item.D-qiizmM.js";import{_ as d}from"./index.DsF1dyOm.js";/* empty css               */import{E as p,a as u}from"./el-select.B8Yt7ohE.js";import"./el-popper.Dsmx6-oh.js";import{E as m}from"./el-dialog.BEP2jboh.js";import{u as c,z as f,E as h,a as w}from"./zh-cn.YHPwkO4t.js";import{E as v,a as g}from"./el-table-column.Ez2OjJKG.js";import"./el-tooltip.l0sNRNKZ.js";import{E as y,a as b,b as _}from"./el-dropdown-item.D2JankPV.js";import{E as k}from"./el-card.cBZ0fBqN.js";import{a as x,c as V,q as C,s as j,d as z,r as U,e as P,f as N}from"./index.bqnhRZMB.js";import{d as E,y as $,o as A,r as q,x as B,k as I,f as O,m as L,w as R,u as S,X as T,F,a as K,A as W,e as X,b as D,t as G,P as H,i as J,_ as M}from"./index.CgXVBBR5.js";import{E as Z}from"./index.0WYdzMvl.js";import{E as Q}from"./index.9F2Msx7d.js";import{E as Y}from"./index.CC6Cg25S.js";import{E as ee}from"./index.DVr-T5fe.js";import"./use-dialog.DBSUL_w9.js";import"./vnode.QC3H8JPp.js";import"./event.BwRzfsZt.js";import"./use-form-item.B50SPf0b.js";import"./index.Dl4VMLFv.js";import"./scroll.BvgvysLU.js";import"./focus-trap.DTfleULh.js";import"./castArray.DsOecpjJ.js";import"./_baseClone.C9FdfYFt.js";import"./_Uint8Array.D5dMbxCO.js";import"./_initCloneObject.HIRWYwTm.js";import"./token.DWNpOE8r.js";import"./isEqual.CCl51Zyn.js";import"./refs.DtOYnHfZ.js";import"./index.DGmEUHa-.js";import"./aria.C-hsWcn7.js";import"./validator.Dk6D7aNm.js";class le{constructor(e,a=null,t=null,o=null,n=null){l(this,"url"),l(this,"ws"),l(this,"close"),l(this,"send");let s=window.location;e=s.host+"/"+e,this.url=/https/.test(s.protocol)?"wss://"+e:"ws://"+e,this.ws=new WebSocket(this.url),this.close=()=>{this.ws.close()},this.send=e=>{this.ws.send(e)},this.ws.onopen=e=>{null!==a&&a(this,e)},this.ws.onmessage=e=>{null!==t&&t(this,e)},this.ws.onerror=e=>{null!=o&&o(this,e)},this.ws.onclose=e=>{null!==n&&n(this,e)}}}const ae={class:"am-container-title"},te={class:"am-container-operator"},oe={class:"am-table"},ne={class:"am-pagination"},se={class:"dialog-footer"},re={class:"am-container-create"},ie={key:0},de={key:0},pe={key:0},ue={class:"am-container-create__operator"},me=M(E({__name:"index",setup(e){const l=$();A((()=>{me(),Ne(),Ue()}));const E={},{data:M,refresh:me,loading:ce,pagination:fe}=c(C,{},{}),he=q(!1),we=q(0),ve=q("");let ge;const ye=e=>"amprobe"===e,be=()=>{he.value=!1,ge.close()},_e=()=>{ge.close()},ke=()=>{const e=document.createElement("a");e.setAttribute("href",`data:text/plain;charset=utf-8,${encodeURIComponent(ve.value)}`),e.setAttribute("download","log.txt"),e.style.display="none",e.click()},xe=q(!1),Ve=q(),Ce=B({containerName:"",imageName:"",networkName:"",ports:[],volumes:[],environments:[],labels:""}),je=B({containerName:[{required:!0,message:"请输入容器名称",trigger:"blur"}],imageName:[{required:!0,message:"请选择镜像",trigger:"blur"}],networkName:[{required:!0,message:"请选择网络",trigger:"blur"}]}),ze=q([]),Ue=async()=>{const{data:e}=await x({page:1,size:100});l.app.setImages(e.data),ze.value=e.data.map((e=>({value:e.name+":"+e.tag,label:e.name+":"+e.tag})))},Pe=q([]),Ne=async()=>{const{data:e}=await V({page:1,size:100});l.app.setNetworks(e.data),Pe.value=e.data.map((e=>({value:e.name,label:e.name})))},Ee=()=>{Ce.ports.push({hostPort:"",containerPort:""})},$e=()=>{Ce.volumes.push({hostPath:"",containerPath:""})},Ae=()=>{Ce.environments.push({key:"",value:""})},qe=q(!1);return(e,c)=>{const x=Q,V=k,C=v,$=Y,A=y,q=b,B=_,Ue=g,Ne=h,Be=w,Ie=ee,Oe=m,Le=r,Re=u,Se=p,Te=d,Fe=i,Ke=t,We=a;return K(),I(F,null,[O("div",ae,[O("span",{onClick:c[0]||(c[0]=l=>e.$router.push("/docker/container"))},"容器"),O("span",{onClick:c[1]||(c[1]=l=>e.$router.push("/docker/image"))},"镜像"),O("span",{onClick:c[2]||(c[2]=l=>e.$router.push("/docker/network"))},"网络"),O("span",{onClick:c[3]||(c[3]=l=>e.$router.push("/docker/settings"))},"设置")]),O("div",te,[L(V,{shadow:"never"},{default:R((()=>[L(x,{type:"primary",plain:"",onClick:c[4]||(c[4]=e=>xe.value=!0)},{default:R((()=>[W("创建容器")])),_:1})])),_:1})]),L(V,{shadow:"never"},{default:R((()=>[O("div",oe,[X((K(),D(Ue,{data:S(M),key:S(we),stripe:"",ref:"multipleTable"},{default:R((()=>[L(C,{prop:"name",label:"容器名称",align:"center","min-width":"120","show-overflow-tooltip":"",fixed:"",sortable:""}),L(C,{prop:"image",label:"镜像名称",align:"center","min-width":"120","show-overflow-tooltip":"",sortable:""}),L(C,{prop:"ip",label:"容器 IP",align:"center","min-width":"100","show-overflow-tooltip":"",sortable:""}),L(C,{prop:"ports",label:"容器端口",align:"center","min-width":"100","show-overflow-tooltip":""}),L(C,{prop:"state",label:"运行状态",align:"center","min-width":"120","show-overflow-tooltip":""},{default:R((e=>[L($,{type:"running"===e.row.state?"success":"danger"},{default:R((()=>[W(G(e.row.state),1)])),_:2},1032,["type"])])),_:1}),L(C,{prop:"uptime",label:"启动时间",align:"center","min-width":"120","show-overflow-tooltip":"",sortable:""}),L(C,{prop:"cpu_percent",label:"CPU使用率",align:"center","min-width":"130","show-overflow-tooltip":"",sortable:""}),L(C,{prop:"memory_percent",label:"内存使用率",align:"center","min-width":"130","show-overflow-tooltip":"",sortable:""}),L(C,{prop:"memory_usage",label:"内存使用量",align:"center","min-width":"130","show-overflow-tooltip":"",sortable:""}),L(C,{prop:"memory_limit",label:"内存限制",align:"center","min-width":"120","show-overflow-tooltip":""}),L(C,{label:"操作",width:"200",fixed:"right",align:"center"},{default:R((e=>[L(x,{type:"primary",size:"small",text:"",onClick:l=>{return a=e.row.id,ve.value="",he.value=!0,void(ge=new le("ws/"+a,((e,l)=>{e.send(a)}),((e,l)=>{ve.value=ve.value+"\n"+l.data})));var a}},{default:R((()=>[W(" 日志 ")])),_:2},1032,["onClick"]),L(x,{type:"primary",size:"small",text:"",onClick:l=>{return a=e.row.id,void j({container_id:a}).finally((()=>{me(),we.value+=1}));var a},disabled:ye(e.row.name)},{default:R((()=>[W(" 启动 ")])),_:2},1032,["onClick","disabled"]),L(B,null,{dropdown:R((()=>[L(q,null,{default:R((()=>[L(A,null,{default:R((()=>[L(x,{type:"warning",size:"small",text:"",onClick:l=>{return a=e.row.id,void z({container_id:a}).finally((()=>{me(),we.value+=1}));var a},disabled:ye(e.row.name)},{default:R((()=>[W(" 停止 ")])),_:2},1032,["onClick","disabled"])])),_:2},1024),L(A,null,{default:R((()=>[L(x,{type:"warning",size:"small",text:"",onClick:l=>{return a=e.row.id,void U({container_id:a}).finally((()=>{me(),we.value+=1}));var a},disabled:ye(e.row.name)},{default:R((()=>[W(" 重启 ")])),_:2},1032,["onClick","disabled"])])),_:2},1024),L(A,null,{default:R((()=>[L(x,{type:"danger",size:"small",text:"",onClick:l=>{return a=e.row.id,void Z.confirm("该操作会强制删除该容器. 继续吗?","警告",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning",beforeClose:(e,l,t)=>{"confirm"===e?(l.confirmButtonLoading=!0,P({container_id:a}).then((()=>{o({type:"success",message:"删除完成"})})).finally((()=>{l.confirmButtonLoading=!1,t(),me(),we.value+=1}))):t()}}).then((()=>{})).catch((()=>{o({type:"info",message:"删除取消"})}));var a},disabled:ye(e.row.name)},{default:R((()=>[W(" 删除 ")])),_:2},1032,["onClick","disabled"])])),_:2},1024)])),_:2},1024)])),default:R((()=>[L(x,{type:"primary",size:"small",text:""},{default:R((()=>[W("更多")])),_:1})])),_:2},1024)])),_:1})])),_:1},8,["data"])),[[We,S(ce)]])]),O("div",ne,[L(Be,{locale:S(f)},{default:R((()=>[L(Ne,{"current-page":S(fe).page,"onUpdate:currentPage":c[5]||(c[5]=e=>S(fe).page=e),"page-size":S(fe).size,layout:"total, sizes, prev, pager, next, jumper","page-sizes":S(fe).sizeOption,total:S(fe).total,onSizeChange:c[6]||(c[6]=e=>S(fe).onSizeChange(e,E)),onCurrentChange:c[7]||(c[7]=e=>S(fe).onPageChange(e,E))},null,8,["current-page","page-size","page-sizes","total"])])),_:1},8,["locale"])])])),_:1}),L(Oe,{modelValue:S(he),"onUpdate:modelValue":c[9]||(c[9]=e=>T(he)?he.value=e:null),title:"日志",width:"50%","before-close":be},{footer:R((()=>[O("div",se,[L(x,{size:"small",type:"primary",plain:"",onClick:ke},{default:R((()=>[W("下载")])),_:1}),L(x,{size:"small",type:"info",plain:"",onClick:_e},{default:R((()=>[W("停止")])),_:1}),L(x,{size:"small",type:"success",plain:"",onClick:be},{default:R((()=>[W("关闭")])),_:1})])])),default:R((()=>[L(Ie,{modelValue:S(ve),"onUpdate:modelValue":c[8]||(c[8]=e=>T(ve)?ve.value=e:null),rows:"20",type:"textarea"},null,8,["modelValue"])])),_:1},8,["modelValue"]),O("div",re,[L(Ke,{modelValue:S(xe),"onUpdate:modelValue":c[16]||(c[16]=e=>T(xe)?xe.value=e:null),size:"50%",title:"创建容器"},{default:R((()=>[L(Fe,{ref_key:"containerCreateRef",ref:Ve,model:S(Ce),rules:S(je),"label-width":"120px","label-position":"left"},{default:R((()=>[L(Le,{label:"名称",prop:"containerName"},{default:R((()=>[L(Ie,{modelValue:S(Ce).containerName,"onUpdate:modelValue":c[10]||(c[10]=e=>S(Ce).containerName=e),placeholder:"请输入名称"},null,8,["modelValue"])])),_:1}),L(Le,{label:"镜像",prop:"imageName"},{default:R((()=>[L(Se,{modelValue:S(Ce).imageName,"onUpdate:modelValue":c[11]||(c[11]=e=>S(Ce).imageName=e),style:{width:"320px"},placeholder:"请选择镜像"},{default:R((()=>[(K(!0),I(F,null,H(S(ze),(e=>(K(),D(Re,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),L(Le,{label:"网络",prop:"networkName"},{default:R((()=>[L(Se,{modelValue:S(Ce).networkName,"onUpdate:modelValue":c[12]||(c[12]=e=>S(Ce).networkName=e),style:{width:"320px"},placeholder:"请选择镜像"},{default:R((()=>[(K(!0),I(F,null,H(S(Pe),(e=>(K(),D(Re,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),L(Le,{label:"端口",prop:"ports"},{default:R((()=>[0===S(Ce).ports.length?(K(),I("span",ie,"可以添加端口绑定")):J("",!0),(K(!0),I(F,null,H(S(Ce).ports,((e,l)=>(K(),D(Le,{key:l,style:{"margin-bottom":"4px"}},{default:R((()=>[L(Ie,{modelValue:e.hostPort,"onUpdate:modelValue":l=>e.hostPort=l,style:{width:"160px"},placeholder:"服务器端口"},null,8,["modelValue","onUpdate:modelValue"]),L(Ie,{modelValue:e.containerPort,"onUpdate:modelValue":l=>e.containerPort=l,style:{width:"160px"},placeholder:"容器端口"},null,8,["modelValue","onUpdate:modelValue"]),L(x,{type:"danger",text:"",onClick:e=>(e=>{Ce.ports.splice(e,1)})(l)},{default:R((()=>[L(Te,{"icon-class":"close"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),L(Le,null,{default:R((()=>[L(x,{type:"primary",text:"",onClick:Ee},{default:R((()=>[W("添加端口"),L(Te,{"icon-class":"plus"})])),_:1})])),_:1}),L(Le,{label:"环境变量",prop:"environments"},{default:R((()=>[0===S(Ce).environments.length?(K(),I("span",de,"可以添加环境变量")):J("",!0),(K(!0),I(F,null,H(S(Ce).environments,((e,l)=>(K(),D(Le,{key:l,style:{"margin-bottom":"4px"}},{default:R((()=>[L(Ie,{modelValue:e.key,"onUpdate:modelValue":l=>e.key=l,style:{width:"160px"},placeholder:"变量名"},null,8,["modelValue","onUpdate:modelValue"]),L(Ie,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,style:{width:"160px"},placeholder:"变量值"},null,8,["modelValue","onUpdate:modelValue"]),L(x,{type:"danger",text:"",onClick:e=>(e=>{Ce.environments.splice(e,1)})(l)},{default:R((()=>[L(Te,{"icon-class":"close"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),L(Le,null,{default:R((()=>[L(x,{type:"primary",text:"",onClick:Ae},{default:R((()=>[W(" 添加环境变量 "),L(Te,{"icon-class":"plus"})])),_:1})])),_:1}),L(Le,{label:"目录/文件挂载",prop:"volumes"},{default:R((()=>[0===S(Ce).volumes.length?(K(),I("span",pe,"可以添加目录/文件挂载")):J("",!0),(K(!0),I(F,null,H(S(Ce).volumes,((e,l)=>(K(),D(Le,{key:l,style:{"margin-bottom":"4px"}},{default:R((()=>[L(Ie,{modelValue:e.hostPath,"onUpdate:modelValue":l=>e.hostPath=l,style:{width:"200px"},placeholder:"服务器目录/文件"},null,8,["modelValue","onUpdate:modelValue"]),L(Ie,{modelValue:e.containerPath,"onUpdate:modelValue":l=>e.containerPath=l,style:{width:"200px"},placeholder:"容器目录/文件"},null,8,["modelValue","onUpdate:modelValue"]),L(x,{type:"danger",text:"",onClick:e=>(e=>{Ce.volumes.splice(e,1)})(l)},{default:R((()=>[L(Te,{"icon-class":"close"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),L(Le,null,{default:R((()=>[L(x,{type:"primary",text:"",onClick:$e},{default:R((()=>[W(" 添加目录/文件挂载"),L(Te,{"icon-class":"plus"})])),_:1})])),_:1}),L(Le,{label:"标签(可选)",prop:"labels"},{default:R((()=>[L(Ie,{modelValue:S(Ce).labels,"onUpdate:modelValue":c[13]||(c[13]=e=>S(Ce).labels=e),type:"textarea",rows:4,placeholder:"一行一个，例如:\nkey1=value1\nkey2=value2"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),O("div",ue,[L(x,{type:"default",size:"default",plain:"",onClick:c[14]||(c[14]=e=>xe.value=!1)},{default:R((()=>[W("取消")])),_:1}),X((K(),D(x,{type:"primary",size:"default",plain:"",onClick:c[15]||(c[15]=e=>(async e=>{e&&await(null==e?void 0:e.validate(((e,a)=>{if(e){qe.value=!0;let e=[],a=[],t=[],o=new Map,r="",i="";for(let l=0;l<Ce.ports.length;l++)e.push(`${Ce.ports[l].hostPort}:${Ce.ports[l].containerPort}`);for(let l=0;l<Ce.volumes.length;l++)a.push(`${Ce.volumes[l].hostPath}:${Ce.volumes[l].containerPath}`);for(let l=0;l<Ce.environments.length;l++)t.push(`${Ce.environments[l].key}=${Ce.environments[l].value}`);if(Ce.labels){const e=Ce.labels.split("\n");for(let l=0;l<e.length;l++){const a=e[l].split(":");o.set(a[0],a[1])}}l.app.networks.filter((e=>e.name===Ce.networkName)).forEach((e=>{e.name==Ce.networkName&&(r=e.driver,i=e.id)}));const d={container_name:Ce.containerName,image_name:Ce.imageName,network_name:Ce.networkName,network_mode:r,network_id:i,ports:e,volumes:a,environments:t,labels:o};N(d).then((e=>{e.data,qe.value=!1,xe.value=!1,s("容器创建成功"),me()})).catch((e=>{n(e),qe.value=!1}))}else n("请检查表单")})))})(S(Ve)))},{default:R((()=>[W(" 确定 ")])),_:1})),[[We,S(qe)]])])])),_:1},8,["modelValue"])])],64)}}}),[["__scopeId","data-v-6e6314d0"]]);export{me as default};

import{F as e,G as a}from"./message.BD1JyyvK.js";import{E as t,a as l,v as r}from"./el-table-column.DVXquyqL.js";import{E as i}from"./el-progress.BwAA94-h.js";import{E as o}from"./el-dialog.pnrbtjWI.js";import"./el-tooltip.l0sNRNKZ.js";import"./el-popper.BxJPsT_Y.js";/* empty css               */import{E as n}from"./el-card.D_4M2h1E.js";import{E as s,a as u,b as d}from"./el-dropdown-item.RDSiHMWk.js";import{_ as c}from"./index.BAL6UHuH.js";import{h as f,i as m,j as p,k as h,l as v}from"./index.C1mAFWzE.js";import{d as g,y as _,r as y,o as C,k as j,f as b,m as w,w as k,u as x,Y as A,F as V,a as z,A as E,e as O,b as U,i as T,t as Y,B as $,C as D,_ as I}from"./index.uDfNkopd.js";import{c as H}from"./convert.B8xZ5nZn.js";import{g as M,d as R}from"./dayjs.min.BglOJP2w.js";import{E as q,a as B}from"./index.r1fn5pBw.js";import{E as F}from"./index.CF_PnOnI.js";import"./use-form-item.Clb94WV_.js";import"./isEqual.DVe1sJUP.js";import"./_Uint8Array.DVFh7HSq.js";import"./_initCloneObject.DfyH-maF.js";import"./_baseClone.JU0fkCRG.js";import"./use-dialog.UpcB4Oaf.js";import"./vnode.Bk1o17iN.js";import"./scroll.v84v66-f.js";import"./focus-trap.Y0jdQh1F.js";import"./refs.DcSG14C5.js";import"./castArray.CQhWY1_U.js";import"./index.D8d6-sT8.js";function G(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function J(e,a){for(var t,l="",r=0,i=-1,o=0,n=0;n<=e.length;++n){if(n<e.length)t=e.charCodeAt(n);else{if(47===t)break;t=47}if(47===t){if(i===n-1||1===o);else if(i!==n-1&&2===o){if(l.length<2||2!==r||46!==l.charCodeAt(l.length-1)||46!==l.charCodeAt(l.length-2))if(l.length>2){var s=l.lastIndexOf("/");if(s!==l.length-1){-1===s?(l="",r=0):r=(l=l.slice(0,s)).length-1-l.lastIndexOf("/"),i=n,o=0;continue}}else if(2===l.length||1===l.length){l="",r=0,i=n,o=0;continue}a&&(l.length>0?l+="/..":l="..",r=2)}else l.length>0?l+="/"+e.slice(i+1,n):l=e.slice(i+1,n),r=n-i-1;i=n,o=0}else 46===t&&-1!==o?++o:o=-1}return l}var L={resolve:function(){for(var e,a="",t=!1,l=arguments.length-1;l>=-1&&!t;l--){var r;l>=0?r=arguments[l]:(void 0===e&&(e=process.cwd()),r=e),G(r),0!==r.length&&(a=r+"/"+a,t=47===r.charCodeAt(0))}return a=J(a,!t),t?a.length>0?"/"+a:"/":a.length>0?a:"."},normalize:function(e){if(G(e),0===e.length)return".";var a=47===e.charCodeAt(0),t=47===e.charCodeAt(e.length-1);return 0!==(e=J(e,!a)).length||a||(e="."),e.length>0&&t&&(e+="/"),a?"/"+e:e},isAbsolute:function(e){return G(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,a=0;a<arguments.length;++a){var t=arguments[a];G(t),t.length>0&&(void 0===e?e=t:e+="/"+t)}return void 0===e?".":L.normalize(e)},relative:function(e,a){if(G(e),G(a),e===a)return"";if((e=L.resolve(e))===(a=L.resolve(a)))return"";for(var t=1;t<e.length&&47===e.charCodeAt(t);++t);for(var l=e.length,r=l-t,i=1;i<a.length&&47===a.charCodeAt(i);++i);for(var o=a.length-i,n=r<o?r:o,s=-1,u=0;u<=n;++u){if(u===n){if(o>n){if(47===a.charCodeAt(i+u))return a.slice(i+u+1);if(0===u)return a.slice(i+u)}else r>n&&(47===e.charCodeAt(t+u)?s=u:0===u&&(s=0));break}var d=e.charCodeAt(t+u);if(d!==a.charCodeAt(i+u))break;47===d&&(s=u)}var c="";for(u=t+s+1;u<=l;++u)u!==l&&47!==e.charCodeAt(u)||(0===c.length?c+="..":c+="/..");return c.length>0?c+a.slice(i+s):(i+=s,47===a.charCodeAt(i)&&++i,a.slice(i))},_makeLong:function(e){return e},dirname:function(e){if(G(e),0===e.length)return".";for(var a=e.charCodeAt(0),t=47===a,l=-1,r=!0,i=e.length-1;i>=1;--i)if(47===(a=e.charCodeAt(i))){if(!r){l=i;break}}else r=!1;return-1===l?t?"/":".":t&&1===l?"//":e.slice(0,l)},basename:function(e,a){if(void 0!==a&&"string"!=typeof a)throw new TypeError('"ext" argument must be a string');G(e);var t,l=0,r=-1,i=!0;if(void 0!==a&&a.length>0&&a.length<=e.length){if(a.length===e.length&&a===e)return"";var o=a.length-1,n=-1;for(t=e.length-1;t>=0;--t){var s=e.charCodeAt(t);if(47===s){if(!i){l=t+1;break}}else-1===n&&(i=!1,n=t+1),o>=0&&(s===a.charCodeAt(o)?-1==--o&&(r=t):(o=-1,r=n))}return l===r?r=n:-1===r&&(r=e.length),e.slice(l,r)}for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!i){l=t+1;break}}else-1===r&&(i=!1,r=t+1);return-1===r?"":e.slice(l,r)},extname:function(e){G(e);for(var a=-1,t=0,l=-1,r=!0,i=0,o=e.length-1;o>=0;--o){var n=e.charCodeAt(o);if(47!==n)-1===l&&(r=!1,l=o+1),46===n?-1===a?a=o:1!==i&&(i=1):-1!==a&&(i=-1);else if(!r){t=o+1;break}}return-1===a||-1===l||0===i||1===i&&a===l-1&&a===t+1?"":e.slice(a,l)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,a){var t=a.dir||a.root,l=a.base||(a.name||"")+(a.ext||"");return t?t===a.root?t+l:t+e+l:l}("/",e)},parse:function(e){G(e);var a={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return a;var t,l=e.charCodeAt(0),r=47===l;r?(a.root="/",t=1):t=0;for(var i=-1,o=0,n=-1,s=!0,u=e.length-1,d=0;u>=t;--u)if(47!==(l=e.charCodeAt(u)))-1===n&&(s=!1,n=u+1),46===l?-1===i?i=u:1!==d&&(d=1):-1!==i&&(d=-1);else if(!s){o=u+1;break}return-1===i||-1===n||0===d||1===d&&i===n-1&&i===o+1?-1!==n&&(a.base=a.name=0===o&&r?e.slice(1,n):e.slice(o,n)):(0===o&&r?(a.name=e.slice(1,i),a.base=e.slice(1,n)):(a.name=e.slice(o,i),a.base=e.slice(o,n)),a.ext=e.slice(i,n)),o>0?a.dir=e.slice(0,o-1):r&&(a.dir="/"),a},sep:"/",delimiter:":",win32:null,posix:null};L.posix=L;const N=M(L),K={class:"am-host-header"},P={class:"am-host-operator"},S={class:"am-table"},Q={style:{display:"flex","align-items":"center"}},W=["onClick"],X={class:"am-host-file-create"},Z={class:"am-host-file-create"},ee={class:"am-host-file-upload"},ae=(e=>($("data-v-4f4ae32a"),e=e(),D(),e))((()=>b("div",{class:"el-upload__text"},[E("Drop file here or "),b("em",null,"click to upload")],-1))),te=I(g({__name:"index",setup(g){const $=_(),D=y(!1),I=y(""),M=y(""),G=y([]);C((()=>{te(I.value,!0)}));const J=()=>{if("/"==I.value)return;M.value=I.value;let e=I.value.split("/");e.pop(),te(e.join("/"),!0)},L=()=>{"/"!=I.value&&te(M.value,!0)},te=async(a,t)=>{if(!t)return void e("该路径不是文件夹");""==a&&(a="/"),D.value=!0,I.value=a;let l={path:a};const{data:r}=await f(l);G.value=r.files,G.value.sort(((e,a)=>e.is_dir&&!a.is_dir?-1:!e.is_dir&&a.is_dir?1:0)),D.value=!1},le=y(0),re=y(!1),ie=()=>{a("上传成功"),re.value=!1,te(I.value,!0)},oe=y(!1),ne=y(!1),se=y(""),ue=async()=>{const e={path:I.value,folder_name:se.value},{data:t}=await h(e);a("创建成功"),ne.value=!1,te(I.value,!0)},de=y(!1),ce=y(""),fe=async()=>{const e={path:I.value,file_name:ce.value},{data:t}=await v(e);a("创建成功"),de.value=!1,te(I.value,!0)};return(e,f)=>{const h=c,v=q,g=B,_=s,y=u,C=d,M=n,me=t,pe=l,he=F,ve=o,ge=i,_e=r;return z(),j(V,null,[b("div",K,[b("span",{onClick:f[0]||(f[0]=a=>e.$router.push("/host/monitor"))},"监控"),b("span",{onClick:f[1]||(f[1]=a=>e.$router.push("/host/file"))},"文件"),b("span",{onClick:f[2]||(f[2]=a=>e.$router.push("/host/terminal"))},"终端"),b("span",{onClick:f[3]||(f[3]=a=>e.$router.push("/host/settings"))},"设置")]),b("div",P,[w(M,{shadow:"never"},{default:k((()=>[w(g,{class:"ml-4",style:{"margin-right":"16px"}},{default:k((()=>[w(v,{type:"primary",onClick:J},{default:k((()=>[w(h,{"icon-class":"back"})])),_:1}),w(v,{type:"primary",onClick:L},{default:k((()=>[w(h,{"icon-class":"next"})])),_:1})])),_:1}),w(C,null,{dropdown:k((()=>[w(y,null,{default:k((()=>[w(_,null,{default:k((()=>[w(v,{type:"primary",size:"small",text:"",onClick:f[4]||(f[4]=e=>ne.value=!0)},{default:k((()=>[w(h,{"icon-class":"folder",style:{color:"#105eeb","margin-right":"4px"}}),E(" 文件夹 ")])),_:1})])),_:1}),w(_,null,{default:k((()=>[w(v,{type:"primary",size:"small",text:"",onClick:f[5]||(f[5]=e=>de.value=!0)},{default:k((()=>[E(" 文件 ")])),_:1})])),_:1})])),_:1})])),default:k((()=>[w(v,{type:"primary",plain:""},{default:k((()=>[E(" 新建 "),w(h,{"icon-class":"down"})])),_:1})])),_:1}),w(v,{type:"primary",plain:"",onClick:f[6]||(f[6]=e=>re.value=!0)},{default:k((()=>[E(" 上传 ")])),_:1})])),_:1})]),w(M,{shadow:"never"},{default:k((()=>[b("div",S,[O((z(),U(pe,{data:x(G),key:x(le),stripe:"",ref:"multipleTable"},{default:k((()=>[w(me,{type:"selection",width:"55"}),w(me,{prop:"name",label:"名称","min-width":"150",align:"center",fixed:""},{default:k((e=>[b("div",Q,[1==e.row.is_dir?(z(),U(h,{key:0,"icon-class":"folder",style:{color:"#105eeb","margin-right":"4px"}})):T("",!0),b("span",{onClick:a=>te(x(N).join(x(I),e.row.name),e.row.is_dir)},Y(e.row.name),9,W)])])),_:1}),w(me,{prop:"size",label:"大小",align:"center","min-width":"100",sortable:""},{default:k((e=>[b("span",null,Y(x(H)(e.row.size)),1)])),_:1}),w(me,{prop:"mode",label:"权限",align:"center","min-width":"100"}),w(me,{prop:"mod_time",label:"修改时间",align:"center","min-width":"100"},{default:k((e=>[b("span",null,Y(x(R)(1e3*e.row.mod_time).format("YYYY-MM-DD HH:mm:ss")),1)])),_:1}),w(me,{label:"操作",width:"200",fixed:"right",align:"center"},{default:k((e=>[w(v,{type:"danger",size:"small",text:"",onClick:t=>(async e=>{const t={filepath:N.join(I.value,e)},{data:l}=await m(t);a("删除成功"),te(I.value,!0)})(e.row.name)},{default:k((()=>[E(" 删除 ")])),_:2},1032,["onClick"]),w(v,{type:"primary",size:"small",text:"",onClick:t=>(async e=>{const t={filepath:N.join(I.value,e)},{data:l}=await p(t);a("下载成功")})(e.row.name)},{default:k((()=>[E(" 下载 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[_e,x(D)]])])])),_:1}),b("div",X,[w(ve,{modelValue:x(de),"onUpdate:modelValue":f[8]||(f[8]=e=>A(de)?de.value=e:null),title:"新建文件",width:"50%"},{default:k((()=>[w(he,{modelValue:x(ce),"onUpdate:modelValue":f[7]||(f[7]=e=>A(ce)?ce.value=e:null),placeholder:"请输入文件名"},null,8,["modelValue"]),O((z(),U(v,{size:"default",type:"info",plain:"",onClick:fe},{default:k((()=>[E(" 确定 ")])),_:1})),[[_e,x(oe)]])])),_:1},8,["modelValue"])]),b("div",Z,[w(ve,{modelValue:x(ne),"onUpdate:modelValue":f[10]||(f[10]=e=>A(ne)?ne.value=e:null),title:"新建文件夹",width:"50%"},{default:k((()=>[w(he,{modelValue:x(se),"onUpdate:modelValue":f[9]||(f[9]=e=>A(se)?se.value=e:null),placeholder:"请输入文件夹名称"},null,8,["modelValue"]),O((z(),U(v,{size:"default",type:"info",plain:"",onClick:ue},{default:k((()=>[E(" 确定 ")])),_:1})),[[_e,x(oe)]])])),_:1},8,["modelValue"])]),b("div",ee,[w(ve,{modelValue:x(re),"onUpdate:modelValue":f[11]||(f[11]=e=>A(re)?re.value=e:null),title:"上传文件",width:"50%"},{default:k((()=>[w(ge,{ref:"uploadRef",drag:"",action:"/app/api/v1/host/file_upload",limit:1,data:{prefix:x(I)},multiple:"",headers:{Authorization:`Bearer ${x($).user.token}`},"on-success":ie},{default:k((()=>[w(h,{"icon-class":"upload"}),ae])),_:1},8,["data","headers"])])),_:1},8,["modelValue"])])],64)}}}),[["__scopeId","data-v-4f4ae32a"]]);export{te as default};

import"./el-input.Jahd1Hjo.js";import{v as e}from"./el-loading.BpbtoYT8.js";import{E as a}from"./el-drawer.BtAgXUfU.js";import{a as l,s as t}from"./index.BEJnBAIn.js";import{a as o,E as n}from"./el-form-item.CmR8yyCj.js";import{_ as s}from"./index.7W5TP-Gr.js";/* empty css               */import{E as r,a as i}from"./el-select.Ds80L7A8.js";import"./el-popper.ByQXy_St.js";import{E as d}from"./el-dialog.BAn0Jijl.js";import{u as p,z as u,E as m,a as c}from"./zh-cn.CmAru0Nm.js";import{E as f,a as h}from"./el-table-column.DtRtph-D.js";import"./el-tooltip.l0sNRNKZ.js";import{E as v,a as w,b as g}from"./el-dropdown-item.CnWWU3D2.js";import{E as _}from"./el-card.C6FIB03H.js";import{a as y,c as b,q as k,s as x,d as C,r as j,e as V,f as z}from"./index.Dl9EuN7S.js";import{W as P}from"./index.av-aa9_u.js";import{d as U,y as E,o as N,r as $,x as A,k as I,f as B,m as O,w as S,u as T,Y as q,F,a as K,A as L,e as M,b as D,t as J,S as Q,i as R,_ as W}from"./index.vLuz2ctl.js";import{E as Y}from"./index.CvHxpMx1.js";import{E as G}from"./index.B8LY5wXu.js";import{E as H}from"./index.gz-8guSF.js";import{E as X}from"./index.CDVZeGTi.js";import"./use-dialog.B4w-7Ecf.js";import"./vnode.BuYHpAJn.js";import"./use-form-item.DGQHv2C0.js";import"./scroll.CNU-wLPw.js";import"./focus-trap.BSN58JPK.js";import"./castArray.DmlTlyrk.js";import"./_baseClone.Byh6-Sp3.js";import"./_Uint8Array.DGEuPrOq.js";import"./_initCloneObject.D7LM1uMc.js";import"./isEqual.DYDatXy1.js";import"./refs.C8C70A12.js";import"./aria.C-hsWcn7.js";const Z={class:"am-container-title"},ee={class:"am-container-operator"},ae={class:"am-table"},le={class:"am-pagination"},te={class:"dialog-footer"},oe={class:"am-container-create"},ne={key:0},se={key:0},re={class:"am-container-create__operator"},ie=W(U({__name:"index",setup(U){const W=E();N((()=>{pe(),je(),xe()}));const ie={},{data:de,refresh:pe,loading:ue,pagination:me}=p(k,{},{}),ce=$(!1),fe=$(0),he=$("");let ve;const we=()=>{ce.value=!1,ve.close()},ge=()=>{ve.close()},_e=()=>{const e=document.createElement("a");e.setAttribute("href",`data:text/plain;charset=utf-8,${encodeURIComponent(he.value)}`),e.setAttribute("download","log.txt"),e.style.display="none",e.click()},ye=$(!1),be=A({containerName:"",imageName:"",networkName:"",ports:[],volumes:[],labels:""}),ke=$([]),xe=async()=>{const{data:e}=await y({page:1,size:100});W.app.setImages(e.data),ke.value=e.data.map((e=>({value:e.name+":"+e.tag,label:e.name+":"+e.tag})))},Ce=$([]),je=async()=>{const{data:e}=await b({page:1,size:100});W.app.setNetworks(e.data),Ce.value=e.data.map((e=>({value:e.name,label:e.name})))},Ve=()=>{be.ports.push({hostPort:"",containerPort:""})},ze=()=>{be.volumes.push({hostPath:"",containerPath:""})},Pe=$(!1),Ue=async()=>{Pe.value=!0;let e=[],a=[],l=new Map,o="",n="";for(let t=0;t<be.ports.length;t++)e.push(`${be.ports[t].hostPort}:${be.ports[t].containerPort}`);for(let t=0;t<be.volumes.length;t++)a.push(`${be.volumes[t].hostPath}:${be.volumes[t].containerPath}`);if(be.labels){const e=be.labels.split("\n");for(let a=0;a<e.length;a++){const t=e[a].split(":");l.set(t[0],t[1])}}W.app.networks.filter((e=>e.name===be.networkName)).forEach((e=>{e.name==be.networkName&&(o=e.driver,n=e.id)}));const s={container_name:be.containerName,image_name:be.imageName,network_name:be.networkName,network_mode:o,network_id:n,ports:e,volumes:a,labels:l},{data:r}=await z(s);t("容器创建成功"),Pe.value=!1,ye.value=!1,pe()};return(t,p)=>{const y=G,b=_,k=f,z=H,U=v,E=w,N=g,$=h,A=m,W=c,xe=X,je=d,Ee=o,Ne=i,$e=r,Ae=s,Ie=n,Be=a,Oe=e;return K(),I(F,null,[B("div",Z,[B("span",{onClick:p[0]||(p[0]=e=>t.$router.push("/docker/container"))},"容器"),B("span",{onClick:p[1]||(p[1]=e=>t.$router.push("/docker/image"))},"镜像"),B("span",{onClick:p[2]||(p[2]=e=>t.$router.push("/docker/network"))},"网络"),B("span",{onClick:p[3]||(p[3]=e=>t.$router.push("/docker/settings"))},"设置")]),B("div",ee,[O(b,{shadow:"never"},{default:S((()=>[O(y,{type:"primary",plain:"",onClick:p[4]||(p[4]=e=>ye.value=!0)},{default:S((()=>[L("创建容器")])),_:1})])),_:1})]),O(b,{shadow:"never"},{default:S((()=>[B("div",ae,[M((K(),D($,{data:T(de),key:T(fe),stripe:"",ref:"multipleTable"},{default:S((()=>[O(k,{prop:"id",label:"容器 ID","min-width":"100",align:"center",fixed:"",sortable:""}),O(k,{prop:"name",label:"容器名称",align:"center","min-width":"120","show-overflow-tooltip":"",fixed:"",sortable:""}),O(k,{prop:"image",label:"镜像名称",align:"center","min-width":"120","show-overflow-tooltip":"",sortable:""}),O(k,{prop:"ip",label:"容器 IP",align:"center","min-width":"100","show-overflow-tooltip":"",sortable:""}),O(k,{prop:"state",label:"运行状态",align:"center","min-width":"120","show-overflow-tooltip":""},{default:S((e=>[O(z,{type:"running"===e.row.state?"success":"danger"},{default:S((()=>[L(J(e.row.state),1)])),_:2},1032,["type"])])),_:1}),O(k,{prop:"uptime",label:"启动时间",align:"center","min-width":"120","show-overflow-tooltip":"",sortable:""}),O(k,{prop:"cpu_percent",label:"CPU使用率",align:"center","min-width":"130","show-overflow-tooltip":"",sortable:""}),O(k,{prop:"memory_percent",label:"内存使用率",align:"center","min-width":"130","show-overflow-tooltip":"",sortable:""}),O(k,{prop:"memory_usage",label:"内存使用量",align:"center","min-width":"130","show-overflow-tooltip":"",sortable:""}),O(k,{prop:"memory_limit",label:"内存限制",align:"center","min-width":"120","show-overflow-tooltip":""}),O(k,{label:"操作",width:"200",fixed:"right",align:"center"},{default:S((e=>[O(y,{type:"primary",size:"small",text:"",onClick:a=>{return l=e.row.id,he.value="",ce.value=!0,void(ve=new P("ws/"+l,((e,a)=>{e.send(l)}),((e,a)=>{he.value=he.value+"\n"+a.data})));var l}},{default:S((()=>[L(" 日志 ")])),_:2},1032,["onClick"]),O(y,{type:"primary",size:"small",text:"",onClick:a=>{return l=e.row.id,void x({container_id:l}).finally((()=>{pe(),fe.value+=1}));var l}},{default:S((()=>[L(" 启动 ")])),_:2},1032,["onClick"]),O(N,null,{dropdown:S((()=>[O(E,null,{default:S((()=>[O(U,null,{default:S((()=>[O(y,{type:"warning",size:"small",text:"",onClick:a=>{return l=e.row.id,void C({container_id:l}).finally((()=>{pe(),fe.value+=1}));var l}},{default:S((()=>[L(" 停止 ")])),_:2},1032,["onClick"])])),_:2},1024),O(U,null,{default:S((()=>[O(y,{type:"warning",size:"small",text:"",onClick:a=>{return l=e.row.id,void j({container_id:l}).finally((()=>{pe(),fe.value+=1}));var l}},{default:S((()=>[L(" 重启 ")])),_:2},1032,["onClick"])])),_:2},1024),O(U,null,{default:S((()=>[O(y,{type:"danger",size:"small",text:"",onClick:a=>{return t=e.row.id,void Y.confirm("该操作会强制删除该容器. 继续吗?","警告",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning",beforeClose:(e,a,o)=>{"confirm"===e?(a.confirmButtonLoading=!0,V({container_id:t}).then((()=>{l({type:"success",message:"删除完成"})})).finally((()=>{a.confirmButtonLoading=!1,o(),pe(),fe.value+=1}))):o()}}).then((()=>{})).catch((()=>{l({type:"info",message:"删除取消"})}));var t}},{default:S((()=>[L(" 删除 ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),default:S((()=>[O(y,{type:"primary",size:"small",text:""},{default:S((()=>[L("更多")])),_:1})])),_:2},1024)])),_:1})])),_:1},8,["data"])),[[Oe,T(ue)]])]),B("div",le,[O(W,{locale:T(u)},{default:S((()=>[O(A,{"current-page":T(me).page,"onUpdate:currentPage":p[5]||(p[5]=e=>T(me).page=e),"page-size":T(me).size,layout:"total, sizes, prev, pager, next, jumper","page-sizes":T(me).sizeOption,total:T(me).total,onSizeChange:p[6]||(p[6]=e=>T(me).onSizeChange(e,ie)),onCurrentChange:p[7]||(p[7]=e=>T(me).onPageChange(e,ie))},null,8,["current-page","page-size","page-sizes","total"])])),_:1},8,["locale"])])])),_:1}),O(je,{modelValue:T(ce),"onUpdate:modelValue":p[9]||(p[9]=e=>q(ce)?ce.value=e:null),title:"日志",width:"50%","before-close":we},{footer:S((()=>[B("div",te,[O(y,{size:"small",type:"primary",plain:"",onClick:_e},{default:S((()=>[L("下载")])),_:1}),O(y,{size:"small",type:"info",plain:"",onClick:ge},{default:S((()=>[L("停止")])),_:1}),O(y,{size:"small",type:"success",plain:"",onClick:we},{default:S((()=>[L("关闭")])),_:1})])])),default:S((()=>[O(xe,{modelValue:T(he),"onUpdate:modelValue":p[8]||(p[8]=e=>q(he)?he.value=e:null),rows:"20",type:"textarea"},null,8,["modelValue"])])),_:1},8,["modelValue"]),B("div",oe,[O(Be,{modelValue:T(ye),"onUpdate:modelValue":p[15]||(p[15]=e=>q(ye)?ye.value=e:null),size:"50%",title:"创建容器"},{default:S((()=>[O(Ie,{ref:"form","label-width":"120px",model:T(be),"label-position":"left"},{default:S((()=>[O(Ee,{label:"名称"},{default:S((()=>[O(xe,{modelValue:T(be).containerName,"onUpdate:modelValue":p[10]||(p[10]=e=>T(be).containerName=e),placeholder:"请输入名称"},null,8,["modelValue"])])),_:1}),O(Ee,{label:"镜像"},{default:S((()=>[O($e,{modelValue:T(be).imageName,"onUpdate:modelValue":p[11]||(p[11]=e=>T(be).imageName=e),style:{width:"320px"},placeholder:"请选择镜像"},{default:S((()=>[(K(!0),I(F,null,Q(T(ke),(e=>(K(),D(Ne,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),O(Ee,{label:"网络"},{default:S((()=>[O($e,{modelValue:T(be).networkName,"onUpdate:modelValue":p[12]||(p[12]=e=>T(be).networkName=e),style:{width:"320px"},placeholder:"请选择镜像"},{default:S((()=>[(K(!0),I(F,null,Q(T(Ce),(e=>(K(),D(Ne,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),O(Ee,{label:"端口"},{default:S((()=>[0===T(be).ports.length?(K(),I("span",ne,"可以添加端口绑定")):R("",!0),(K(!0),I(F,null,Q(T(be).ports,((e,a)=>(K(),D(Ee,{key:a,style:{"margin-bottom":"4px"}},{default:S((()=>[O(xe,{modelValue:e.hostPort,"onUpdate:modelValue":a=>e.hostPort=a,style:{width:"160px"},placeholder:"服务器端口"},null,8,["modelValue","onUpdate:modelValue"]),O(xe,{modelValue:e.containerPort,"onUpdate:modelValue":a=>e.containerPort=a,style:{width:"160px"},placeholder:"容器端口"},null,8,["modelValue","onUpdate:modelValue"]),O(y,{type:"danger",text:"",onClick:e=>(e=>{be.ports.splice(e,1)})(a)},{default:S((()=>[O(Ae,{"icon-class":"close"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),O(Ee,null,{default:S((()=>[O(y,{type:"primary",text:"",onClick:Ve},{default:S((()=>[L("添加端口"),O(Ae,{"icon-class":"plus"})])),_:1})])),_:1}),O(Ee,{label:"目录/文件挂载"},{default:S((()=>[0===T(be).volumes.length?(K(),I("span",se,"可以添加目录/文件挂载")):R("",!0),(K(!0),I(F,null,Q(T(be).volumes,((e,a)=>(K(),D(Ee,{key:a,style:{"margin-bottom":"4px"}},{default:S((()=>[O(xe,{modelValue:e.hostPath,"onUpdate:modelValue":a=>e.hostPath=a,style:{width:"200px"},placeholder:"服务器目录/文件"},null,8,["modelValue","onUpdate:modelValue"]),O(xe,{modelValue:e.containerPath,"onUpdate:modelValue":a=>e.containerPath=a,style:{width:"200px"},placeholder:"容器目录/文件"},null,8,["modelValue","onUpdate:modelValue"]),O(y,{type:"danger",text:"",onClick:e=>(e=>{be.volumes.splice(e,1)})(a)},{default:S((()=>[O(Ae,{"icon-class":"close"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),O(Ee,null,{default:S((()=>[O(y,{type:"primary",text:"",onClick:ze},{default:S((()=>[L(" 添加目录/文件挂载"),O(Ae,{"icon-class":"plus"})])),_:1})])),_:1}),O(Ee,{label:"标签(可选)"},{default:S((()=>[O(xe,{modelValue:T(be).labels,"onUpdate:modelValue":p[13]||(p[13]=e=>T(be).labels=e),type:"textarea",rows:4,placeholder:"一行一个，例如:\nkey1=value1\nkey2=value2"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),B("div",re,[O(y,{type:"default",size:"default",plain:"",onClick:p[14]||(p[14]=e=>ye.value=!1)},{default:S((()=>[L("取消")])),_:1}),M((K(),D(y,{type:"primary",size:"default",plain:"",onClick:Ue},{default:S((()=>[L(" 确定 ")])),_:1})),[[Oe,T(Pe)]])])])),_:1},8,["modelValue"])])],64)}}}),[["__scopeId","data-v-d3e88004"]]);export{ie as default};

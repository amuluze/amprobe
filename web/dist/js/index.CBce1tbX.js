var e=Object.defineProperty,l=(l,a,t)=>((l,a,t)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t)(l,"symbol"!=typeof a?a+"":a,t);import{j as a,F as t,G as o}from"./message.CS_TSLeJ.js";import{E as s,a as n,v as r}from"./el-table-column.CUrmI2vn.js";import{E as i}from"./el-drawer.Q6nFi8Na.js";import{a as u,E as p}from"./el-form-item.THx8gv2Q.js";import{_ as d}from"./index.ebzY_tEX.js";/* empty css               */import{E as m,a as c}from"./el-select.D4WZ4Qh9.js";import"./el-popper.GbrdInRL.js";import{E as f}from"./el-dialog.BQ3hfU_k.js";import{u as h,z as w,E as g,a as v}from"./zh-cn.PWYwJho2.js";import"./el-tooltip.l0sNRNKZ.js";import{E as y,a as _,b}from"./el-dropdown-item.D4DuefXG.js";import{E as k}from"./el-card.CS5WT6tL.js";import{a as x,c as C,q as j,s as V,d as z,r as N,e as P,f as U}from"./index.9iOzwdYR.js";import{d as E,y as $,o as q,r as A,x as I,k as O,f as B,m as S,w as F,u as R,Y as T,F as K,a as L,A as M,e as D,b as G,t as J,S as Q,i as W,_ as Y}from"./index.DuNUv9gK.js";import{E as H}from"./index.HvR5tX07.js";import{E as X}from"./index.Ck8DkNjZ.js";import{E as Z}from"./index.BusWp8wr.js";import{E as ee}from"./index.Cb0Nm553.js";import"./use-form-item.CZ2M-1KL.js";import"./isEqual.C8I6FPlV.js";import"./_Uint8Array.Bq4iIfDz.js";import"./_initCloneObject.CpUBN0YX.js";import"./use-dialog.CZCXc5Xp.js";import"./vnode.BrXPxjYI.js";import"./scroll.15sbxcXA.js";import"./focus-trap.D1Nefh4a.js";import"./castArray.CZ4MN7ta.js";import"./_baseClone.D8XUM9zm.js";import"./refs.Cp7KSzlX.js";import"./index.D8XJyr-Y.js";import"./aria.C-hsWcn7.js";class le{constructor(e,a=null,t=null,o=null,s=null){l(this,"url"),l(this,"ws"),l(this,"close"),l(this,"send");let n=window.location;e=n.host+"/"+e,this.url=/https/.test(n.protocol)?"wss://"+e:"ws://"+e,this.ws=new WebSocket(this.url),this.close=()=>{this.ws.close()},this.send=e=>{this.ws.send(e)},this.ws.onopen=e=>{null!==a&&a(this,e)},this.ws.onmessage=e=>{null!==t&&t(this,e)},this.ws.onerror=e=>{null!=o&&o(this,e)},this.ws.onclose=e=>{null!==s&&s(this,e)}}}const ae={class:"am-container-title"},te={class:"am-container-operator"},oe={class:"am-table"},se={class:"am-pagination"},ne={class:"dialog-footer"},re={class:"am-container-create"},ie={key:0},ue={key:0},pe={class:"am-container-create__operator"},de=Y(E({__name:"index",setup(e){const l=$();q((()=>{de(),Ne(),Ve()}));const E={},{data:Y,refresh:de,loading:me,pagination:ce}=h(j,{},{}),fe=A(!1),he=A(0),we=A("");let ge;const ve=()=>{fe.value=!1,ge.close()},ye=()=>{ge.close()},_e=()=>{const e=document.createElement("a");e.setAttribute("href",`data:text/plain;charset=utf-8,${encodeURIComponent(we.value)}`),e.setAttribute("download","log.txt"),e.style.display="none",e.click()},be=A(!1),ke=A(),xe=I({containerName:"",imageName:"",networkName:"",ports:[],volumes:[],labels:""}),Ce=I({containerName:[{required:!0,message:"请输入容器名称",trigger:"blur"}],imageName:[{required:!0,message:"请选择镜像",trigger:"blur"}],networkName:[{required:!0,message:"请选择网络",trigger:"blur"}]}),je=A([]),Ve=async()=>{const{data:e}=await x({page:1,size:100});l.app.setImages(e.data),je.value=e.data.map((e=>({value:e.name+":"+e.tag,label:e.name+":"+e.tag})))},ze=A([]),Ne=async()=>{const{data:e}=await C({page:1,size:100});l.app.setNetworks(e.data),ze.value=e.data.map((e=>({value:e.name,label:e.name})))},Pe=()=>{xe.ports.push({hostPort:"",containerPort:""})},Ue=()=>{xe.volumes.push({hostPath:"",containerPath:""})},Ee=A(!1);return(e,h)=>{const x=X,C=k,j=s,$=Z,q=y,A=_,I=b,Ve=n,Ne=g,$e=v,qe=ee,Ae=f,Ie=u,Oe=c,Be=m,Se=d,Fe=p,Re=i,Te=r;return L(),O(K,null,[B("div",ae,[B("span",{onClick:h[0]||(h[0]=l=>e.$router.push("/docker/container"))},"容器"),B("span",{onClick:h[1]||(h[1]=l=>e.$router.push("/docker/image"))},"镜像"),B("span",{onClick:h[2]||(h[2]=l=>e.$router.push("/docker/network"))},"网络"),B("span",{onClick:h[3]||(h[3]=l=>e.$router.push("/docker/settings"))},"设置")]),B("div",te,[S(C,{shadow:"never"},{default:F((()=>[S(x,{type:"primary",plain:"",onClick:h[4]||(h[4]=e=>be.value=!0)},{default:F((()=>[M("创建容器")])),_:1})])),_:1})]),S(C,{shadow:"never"},{default:F((()=>[B("div",oe,[D((L(),G(Ve,{data:R(Y),key:R(he),stripe:"",ref:"multipleTable"},{default:F((()=>[S(j,{prop:"id",label:"容器 ID","min-width":"100",align:"center",fixed:"",sortable:""}),S(j,{prop:"name",label:"容器名称",align:"center","min-width":"120","show-overflow-tooltip":"",fixed:"",sortable:""}),S(j,{prop:"image",label:"镜像名称",align:"center","min-width":"120","show-overflow-tooltip":"",sortable:""}),S(j,{prop:"ip",label:"容器 IP",align:"center","min-width":"100","show-overflow-tooltip":"",sortable:""}),S(j,{prop:"state",label:"运行状态",align:"center","min-width":"120","show-overflow-tooltip":""},{default:F((e=>[S($,{type:"running"===e.row.state?"success":"danger"},{default:F((()=>[M(J(e.row.state),1)])),_:2},1032,["type"])])),_:1}),S(j,{prop:"uptime",label:"启动时间",align:"center","min-width":"120","show-overflow-tooltip":"",sortable:""}),S(j,{prop:"cpu_percent",label:"CPU使用率",align:"center","min-width":"130","show-overflow-tooltip":"",sortable:""}),S(j,{prop:"memory_percent",label:"内存使用率",align:"center","min-width":"130","show-overflow-tooltip":"",sortable:""}),S(j,{prop:"memory_usage",label:"内存使用量",align:"center","min-width":"130","show-overflow-tooltip":"",sortable:""}),S(j,{prop:"memory_limit",label:"内存限制",align:"center","min-width":"120","show-overflow-tooltip":""}),S(j,{label:"操作",width:"200",fixed:"right",align:"center"},{default:F((e=>[S(x,{type:"primary",size:"small",text:"",onClick:l=>{return a=e.row.id,we.value="",fe.value=!0,void(ge=new le("ws/"+a,((e,l)=>{e.send(a)}),((e,l)=>{we.value=we.value+"\n"+l.data})));var a}},{default:F((()=>[M(" 日志 ")])),_:2},1032,["onClick"]),S(x,{type:"primary",size:"small",text:"",onClick:l=>{return a=e.row.id,void V({container_id:a}).finally((()=>{de(),he.value+=1}));var a}},{default:F((()=>[M(" 启动 ")])),_:2},1032,["onClick"]),S(I,null,{dropdown:F((()=>[S(A,null,{default:F((()=>[S(q,null,{default:F((()=>[S(x,{type:"warning",size:"small",text:"",onClick:l=>{return a=e.row.id,void z({container_id:a}).finally((()=>{de(),he.value+=1}));var a}},{default:F((()=>[M(" 停止 ")])),_:2},1032,["onClick"])])),_:2},1024),S(q,null,{default:F((()=>[S(x,{type:"warning",size:"small",text:"",onClick:l=>{return a=e.row.id,void N({container_id:a}).finally((()=>{de(),he.value+=1}));var a}},{default:F((()=>[M(" 重启 ")])),_:2},1032,["onClick"])])),_:2},1024),S(q,null,{default:F((()=>[S(x,{type:"danger",size:"small",text:"",onClick:l=>{return t=e.row.id,void H.confirm("该操作会强制删除该容器. 继续吗?","警告",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning",beforeClose:(e,l,o)=>{"confirm"===e?(l.confirmButtonLoading=!0,P({container_id:t}).then((()=>{a({type:"success",message:"删除完成"})})).finally((()=>{l.confirmButtonLoading=!1,o(),de(),he.value+=1}))):o()}}).then((()=>{})).catch((()=>{a({type:"info",message:"删除取消"})}));var t}},{default:F((()=>[M(" 删除 ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),default:F((()=>[S(x,{type:"primary",size:"small",text:""},{default:F((()=>[M("更多")])),_:1})])),_:2},1024)])),_:1})])),_:1},8,["data"])),[[Te,R(me)]])]),B("div",se,[S($e,{locale:R(w)},{default:F((()=>[S(Ne,{"current-page":R(ce).page,"onUpdate:currentPage":h[5]||(h[5]=e=>R(ce).page=e),"page-size":R(ce).size,layout:"total, sizes, prev, pager, next, jumper","page-sizes":R(ce).sizeOption,total:R(ce).total,onSizeChange:h[6]||(h[6]=e=>R(ce).onSizeChange(e,E)),onCurrentChange:h[7]||(h[7]=e=>R(ce).onPageChange(e,E))},null,8,["current-page","page-size","page-sizes","total"])])),_:1},8,["locale"])])])),_:1}),S(Ae,{modelValue:R(fe),"onUpdate:modelValue":h[9]||(h[9]=e=>T(fe)?fe.value=e:null),title:"日志",width:"50%","before-close":ve},{footer:F((()=>[B("div",ne,[S(x,{size:"small",type:"primary",plain:"",onClick:_e},{default:F((()=>[M("下载")])),_:1}),S(x,{size:"small",type:"info",plain:"",onClick:ye},{default:F((()=>[M("停止")])),_:1}),S(x,{size:"small",type:"success",plain:"",onClick:ve},{default:F((()=>[M("关闭")])),_:1})])])),default:F((()=>[S(qe,{modelValue:R(we),"onUpdate:modelValue":h[8]||(h[8]=e=>T(we)?we.value=e:null),rows:"20",type:"textarea"},null,8,["modelValue"])])),_:1},8,["modelValue"]),B("div",re,[S(Re,{modelValue:R(be),"onUpdate:modelValue":h[16]||(h[16]=e=>T(be)?be.value=e:null),size:"50%",title:"创建容器"},{default:F((()=>[S(Fe,{ref_key:"containerCreateRef",ref:ke,model:R(xe),rules:R(Ce),"label-width":"120px","label-position":"left"},{default:F((()=>[S(Ie,{label:"名称",prop:"containerName"},{default:F((()=>[S(qe,{modelValue:R(xe).containerName,"onUpdate:modelValue":h[10]||(h[10]=e=>R(xe).containerName=e),placeholder:"请输入名称"},null,8,["modelValue"])])),_:1}),S(Ie,{label:"镜像",prop:"imageName"},{default:F((()=>[S(Be,{modelValue:R(xe).imageName,"onUpdate:modelValue":h[11]||(h[11]=e=>R(xe).imageName=e),style:{width:"320px"},placeholder:"请选择镜像"},{default:F((()=>[(L(!0),O(K,null,Q(R(je),(e=>(L(),G(Oe,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(Ie,{label:"网络",prop:"networkName"},{default:F((()=>[S(Be,{modelValue:R(xe).networkName,"onUpdate:modelValue":h[12]||(h[12]=e=>R(xe).networkName=e),style:{width:"320px"},placeholder:"请选择镜像"},{default:F((()=>[(L(!0),O(K,null,Q(R(ze),(e=>(L(),G(Oe,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(Ie,{label:"端口",prop:"ports"},{default:F((()=>[0===R(xe).ports.length?(L(),O("span",ie,"可以添加端口绑定")):W("",!0),(L(!0),O(K,null,Q(R(xe).ports,((e,l)=>(L(),G(Ie,{key:l,style:{"margin-bottom":"4px"}},{default:F((()=>[S(qe,{modelValue:e.hostPort,"onUpdate:modelValue":l=>e.hostPort=l,style:{width:"160px"},placeholder:"服务器端口"},null,8,["modelValue","onUpdate:modelValue"]),S(qe,{modelValue:e.containerPort,"onUpdate:modelValue":l=>e.containerPort=l,style:{width:"160px"},placeholder:"容器端口"},null,8,["modelValue","onUpdate:modelValue"]),S(x,{type:"danger",text:"",onClick:e=>(e=>{xe.ports.splice(e,1)})(l)},{default:F((()=>[S(Se,{"icon-class":"close"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),S(Ie,null,{default:F((()=>[S(x,{type:"primary",text:"",onClick:Pe},{default:F((()=>[M("添加端口"),S(Se,{"icon-class":"plus"})])),_:1})])),_:1}),S(Ie,{label:"目录/文件挂载",prop:"volumnes"},{default:F((()=>[0===R(xe).volumes.length?(L(),O("span",ue,"可以添加目录/文件挂载")):W("",!0),(L(!0),O(K,null,Q(R(xe).volumes,((e,l)=>(L(),G(Ie,{key:l,style:{"margin-bottom":"4px"}},{default:F((()=>[S(qe,{modelValue:e.hostPath,"onUpdate:modelValue":l=>e.hostPath=l,style:{width:"200px"},placeholder:"服务器目录/文件"},null,8,["modelValue","onUpdate:modelValue"]),S(qe,{modelValue:e.containerPath,"onUpdate:modelValue":l=>e.containerPath=l,style:{width:"200px"},placeholder:"容器目录/文件"},null,8,["modelValue","onUpdate:modelValue"]),S(x,{type:"danger",text:"",onClick:e=>(e=>{xe.volumes.splice(e,1)})(l)},{default:F((()=>[S(Se,{"icon-class":"close"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),S(Ie,null,{default:F((()=>[S(x,{type:"primary",text:"",onClick:Ue},{default:F((()=>[M(" 添加目录/文件挂载"),S(Se,{"icon-class":"plus"})])),_:1})])),_:1}),S(Ie,{label:"标签(可选)",prop:"labels"},{default:F((()=>[S(qe,{modelValue:R(xe).labels,"onUpdate:modelValue":h[13]||(h[13]=e=>R(xe).labels=e),type:"textarea",rows:4,placeholder:"一行一个，例如:\nkey1=value1\nkey2=value2"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),B("div",pe,[S(x,{type:"default",size:"default",plain:"",onClick:h[14]||(h[14]=e=>be.value=!1)},{default:F((()=>[M("取消")])),_:1}),D((L(),G(x,{type:"primary",size:"default",plain:"",onClick:h[15]||(h[15]=e=>(async e=>{e&&await(null==e?void 0:e.validate(((e,a)=>{if(e){Ee.value=!0;let e=[],a=[],s=new Map,n="",r="";for(let l=0;l<xe.ports.length;l++)e.push(`${xe.ports[l].hostPort}:${xe.ports[l].containerPort}`);for(let l=0;l<xe.volumes.length;l++)a.push(`${xe.volumes[l].hostPath}:${xe.volumes[l].containerPath}`);if(xe.labels){const e=xe.labels.split("\n");for(let l=0;l<e.length;l++){const a=e[l].split(":");s.set(a[0],a[1])}}l.app.networks.filter((e=>e.name===xe.networkName)).forEach((e=>{e.name==xe.networkName&&(n=e.driver,r=e.id)}));const i={container_name:xe.containerName,image_name:xe.imageName,network_name:xe.networkName,network_mode:n,network_id:r,ports:e,volumes:a,labels:s};U(i).then((e=>{e.data,Ee.value=!1,be.value=!1,o("容器创建成功"),de()})).catch((e=>{t(e),Ee.value=!1}))}else t("请检查表单")})))})(R(ke)))},{default:F((()=>[M(" 确定 ")])),_:1})),[[Te,R(Ee)]])])])),_:1},8,["modelValue"])])],64)}}}),[["__scopeId","data-v-31b42ea1"]]);export{de as default};

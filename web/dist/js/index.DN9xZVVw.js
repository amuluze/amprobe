var e=Object.defineProperty,l=(l,a,t)=>((l,a,t)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t)(l,"symbol"!=typeof a?a+"":a,t);import{j as a,G as t}from"./message.BD1JyyvK.js";import{E as o,a as s,v as n}from"./el-table-column.DVXquyqL.js";import{E as i}from"./el-drawer.Di40ZNFV.js";import{a as r,E as d}from"./el-form-item.BoTgIbLe.js";import{_ as u}from"./index.BAL6UHuH.js";/* empty css               */import{E as p,a as m}from"./el-select.BXVizdwL.js";import"./el-popper.BxJPsT_Y.js";import{E as c}from"./el-dialog.pnrbtjWI.js";import{u as f,z as h,E as w,a as v}from"./zh-cn.UGuc3-Lg.js";import"./el-tooltip.l0sNRNKZ.js";import{E as g,a as y,b as _}from"./el-dropdown-item.RDSiHMWk.js";import{E as b}from"./el-card.D_4M2h1E.js";import{a as k,c as x,q as C,s as j,d as V,r as z,e as P,f as U}from"./index.CgyXObx3.js";import{d as E,y as N,o as $,r as A,x as I,k as O,f as B,m as S,w as q,u as T,Y as F,F as K,a as L,A as M,e as R,b as D,t as G,S as J,i as Q,_ as W}from"./index.uDfNkopd.js";import{E as Y}from"./index.BP_LtWkv.js";import{E as H}from"./index.r1fn5pBw.js";import{E as X}from"./index.BNwDbrxS.js";import{E as Z}from"./index.CF_PnOnI.js";import"./use-form-item.Clb94WV_.js";import"./isEqual.DVe1sJUP.js";import"./_Uint8Array.DVFh7HSq.js";import"./_initCloneObject.DfyH-maF.js";import"./use-dialog.UpcB4Oaf.js";import"./vnode.Bk1o17iN.js";import"./scroll.v84v66-f.js";import"./focus-trap.Y0jdQh1F.js";import"./castArray.CQhWY1_U.js";import"./_baseClone.JU0fkCRG.js";import"./refs.DcSG14C5.js";import"./index.D8d6-sT8.js";import"./aria.C-hsWcn7.js";class ee{constructor(e,a=null,t=null,o=null,s=null){l(this,"url"),l(this,"ws"),l(this,"close"),l(this,"send");let n=window.location;e=n.host+"/"+e,this.url=/https/.test(n.protocol)?"wss://"+e:"ws://"+e,this.ws=new WebSocket(this.url),this.close=()=>{this.ws.close()},this.send=e=>{this.ws.send(e)},this.ws.onopen=e=>{null!==a&&a(this,e)},this.ws.onmessage=e=>{null!==t&&t(this,e)},this.ws.onerror=e=>{null!=o&&o(this,e)},this.ws.onclose=e=>{null!==s&&s(this,e)}}}const le={class:"am-container-title"},ae={class:"am-container-operator"},te={class:"am-table"},oe={class:"am-pagination"},se={class:"dialog-footer"},ne={class:"am-container-create"},ie={key:0},re={key:0},de={class:"am-container-create__operator"},ue=W(E({__name:"index",setup(e){const l=N();$((()=>{ue(),je(),xe()}));const E={},{data:W,refresh:ue,loading:pe,pagination:me}=f(C,{},{}),ce=A(!1),fe=A(0),he=A("");let we;const ve=()=>{ce.value=!1,we.close()},ge=()=>{we.close()},ye=()=>{const e=document.createElement("a");e.setAttribute("href",`data:text/plain;charset=utf-8,${encodeURIComponent(he.value)}`),e.setAttribute("download","log.txt"),e.style.display="none",e.click()},_e=A(!1),be=I({containerName:"",imageName:"",networkName:"",ports:[],volumes:[],labels:""}),ke=A([]),xe=async()=>{const{data:e}=await k({page:1,size:100});l.app.setImages(e.data),ke.value=e.data.map((e=>({value:e.name+":"+e.tag,label:e.name+":"+e.tag})))},Ce=A([]),je=async()=>{const{data:e}=await x({page:1,size:100});l.app.setNetworks(e.data),Ce.value=e.data.map((e=>({value:e.name,label:e.name})))},Ve=()=>{be.ports.push({hostPort:"",containerPort:""})},ze=()=>{be.volumes.push({hostPath:"",containerPath:""})},Pe=A(!1),Ue=async()=>{Pe.value=!0;let e=[],a=[],o=new Map,s="",n="";for(let l=0;l<be.ports.length;l++)e.push(`${be.ports[l].hostPort}:${be.ports[l].containerPort}`);for(let l=0;l<be.volumes.length;l++)a.push(`${be.volumes[l].hostPath}:${be.volumes[l].containerPath}`);if(be.labels){const e=be.labels.split("\n");for(let l=0;l<e.length;l++){const a=e[l].split(":");o.set(a[0],a[1])}}l.app.networks.filter((e=>e.name===be.networkName)).forEach((e=>{e.name==be.networkName&&(s=e.driver,n=e.id)}));const i={container_name:be.containerName,image_name:be.imageName,network_name:be.networkName,network_mode:s,network_id:n,ports:e,volumes:a,labels:o},{data:r}=await U(i);t("容器创建成功"),Pe.value=!1,_e.value=!1,ue()};return(e,l)=>{const t=H,f=b,k=o,x=X,C=g,U=y,N=_,$=s,A=w,I=v,xe=Z,je=c,Ee=r,Ne=m,$e=p,Ae=u,Ie=d,Oe=i,Be=n;return L(),O(K,null,[B("div",le,[B("span",{onClick:l[0]||(l[0]=l=>e.$router.push("/docker/container"))},"容器"),B("span",{onClick:l[1]||(l[1]=l=>e.$router.push("/docker/image"))},"镜像"),B("span",{onClick:l[2]||(l[2]=l=>e.$router.push("/docker/network"))},"网络"),B("span",{onClick:l[3]||(l[3]=l=>e.$router.push("/docker/settings"))},"设置")]),B("div",ae,[S(f,{shadow:"never"},{default:q((()=>[S(t,{type:"primary",plain:"",onClick:l[4]||(l[4]=e=>_e.value=!0)},{default:q((()=>[M("创建容器")])),_:1})])),_:1})]),S(f,{shadow:"never"},{default:q((()=>[B("div",te,[R((L(),D($,{data:T(W),key:T(fe),stripe:"",ref:"multipleTable"},{default:q((()=>[S(k,{prop:"id",label:"容器 ID","min-width":"100",align:"center",fixed:"",sortable:""}),S(k,{prop:"name",label:"容器名称",align:"center","min-width":"120","show-overflow-tooltip":"",fixed:"",sortable:""}),S(k,{prop:"image",label:"镜像名称",align:"center","min-width":"120","show-overflow-tooltip":"",sortable:""}),S(k,{prop:"ip",label:"容器 IP",align:"center","min-width":"100","show-overflow-tooltip":"",sortable:""}),S(k,{prop:"state",label:"运行状态",align:"center","min-width":"120","show-overflow-tooltip":""},{default:q((e=>[S(x,{type:"running"===e.row.state?"success":"danger"},{default:q((()=>[M(G(e.row.state),1)])),_:2},1032,["type"])])),_:1}),S(k,{prop:"uptime",label:"启动时间",align:"center","min-width":"120","show-overflow-tooltip":"",sortable:""}),S(k,{prop:"cpu_percent",label:"CPU使用率",align:"center","min-width":"130","show-overflow-tooltip":"",sortable:""}),S(k,{prop:"memory_percent",label:"内存使用率",align:"center","min-width":"130","show-overflow-tooltip":"",sortable:""}),S(k,{prop:"memory_usage",label:"内存使用量",align:"center","min-width":"130","show-overflow-tooltip":"",sortable:""}),S(k,{prop:"memory_limit",label:"内存限制",align:"center","min-width":"120","show-overflow-tooltip":""}),S(k,{label:"操作",width:"200",fixed:"right",align:"center"},{default:q((e=>[S(t,{type:"primary",size:"small",text:"",onClick:l=>{return a=e.row.id,he.value="",ce.value=!0,void(we=new ee("ws/"+a,((e,l)=>{e.send(a)}),((e,l)=>{he.value=he.value+"\n"+l.data})));var a}},{default:q((()=>[M(" 日志 ")])),_:2},1032,["onClick"]),S(t,{type:"primary",size:"small",text:"",onClick:l=>{return a=e.row.id,void j({container_id:a}).finally((()=>{ue(),fe.value+=1}));var a}},{default:q((()=>[M(" 启动 ")])),_:2},1032,["onClick"]),S(N,null,{dropdown:q((()=>[S(U,null,{default:q((()=>[S(C,null,{default:q((()=>[S(t,{type:"warning",size:"small",text:"",onClick:l=>{return a=e.row.id,void V({container_id:a}).finally((()=>{ue(),fe.value+=1}));var a}},{default:q((()=>[M(" 停止 ")])),_:2},1032,["onClick"])])),_:2},1024),S(C,null,{default:q((()=>[S(t,{type:"warning",size:"small",text:"",onClick:l=>{return a=e.row.id,void z({container_id:a}).finally((()=>{ue(),fe.value+=1}));var a}},{default:q((()=>[M(" 重启 ")])),_:2},1032,["onClick"])])),_:2},1024),S(C,null,{default:q((()=>[S(t,{type:"danger",size:"small",text:"",onClick:l=>{return t=e.row.id,void Y.confirm("该操作会强制删除该容器. 继续吗?","警告",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning",beforeClose:(e,l,o)=>{"confirm"===e?(l.confirmButtonLoading=!0,P({container_id:t}).then((()=>{a({type:"success",message:"删除完成"})})).finally((()=>{l.confirmButtonLoading=!1,o(),ue(),fe.value+=1}))):o()}}).then((()=>{})).catch((()=>{a({type:"info",message:"删除取消"})}));var t}},{default:q((()=>[M(" 删除 ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),default:q((()=>[S(t,{type:"primary",size:"small",text:""},{default:q((()=>[M("更多")])),_:1})])),_:2},1024)])),_:1})])),_:1},8,["data"])),[[Be,T(pe)]])]),B("div",oe,[S(I,{locale:T(h)},{default:q((()=>[S(A,{"current-page":T(me).page,"onUpdate:currentPage":l[5]||(l[5]=e=>T(me).page=e),"page-size":T(me).size,layout:"total, sizes, prev, pager, next, jumper","page-sizes":T(me).sizeOption,total:T(me).total,onSizeChange:l[6]||(l[6]=e=>T(me).onSizeChange(e,E)),onCurrentChange:l[7]||(l[7]=e=>T(me).onPageChange(e,E))},null,8,["current-page","page-size","page-sizes","total"])])),_:1},8,["locale"])])])),_:1}),S(je,{modelValue:T(ce),"onUpdate:modelValue":l[9]||(l[9]=e=>F(ce)?ce.value=e:null),title:"日志",width:"50%","before-close":ve},{footer:q((()=>[B("div",se,[S(t,{size:"small",type:"primary",plain:"",onClick:ye},{default:q((()=>[M("下载")])),_:1}),S(t,{size:"small",type:"info",plain:"",onClick:ge},{default:q((()=>[M("停止")])),_:1}),S(t,{size:"small",type:"success",plain:"",onClick:ve},{default:q((()=>[M("关闭")])),_:1})])])),default:q((()=>[S(xe,{modelValue:T(he),"onUpdate:modelValue":l[8]||(l[8]=e=>F(he)?he.value=e:null),rows:"20",type:"textarea"},null,8,["modelValue"])])),_:1},8,["modelValue"]),B("div",ne,[S(Oe,{modelValue:T(_e),"onUpdate:modelValue":l[15]||(l[15]=e=>F(_e)?_e.value=e:null),size:"50%",title:"创建容器"},{default:q((()=>[S(Ie,{ref:"form","label-width":"120px",model:T(be),"label-position":"left"},{default:q((()=>[S(Ee,{label:"名称"},{default:q((()=>[S(xe,{modelValue:T(be).containerName,"onUpdate:modelValue":l[10]||(l[10]=e=>T(be).containerName=e),placeholder:"请输入名称"},null,8,["modelValue"])])),_:1}),S(Ee,{label:"镜像"},{default:q((()=>[S($e,{modelValue:T(be).imageName,"onUpdate:modelValue":l[11]||(l[11]=e=>T(be).imageName=e),style:{width:"320px"},placeholder:"请选择镜像"},{default:q((()=>[(L(!0),O(K,null,J(T(ke),(e=>(L(),D(Ne,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(Ee,{label:"网络"},{default:q((()=>[S($e,{modelValue:T(be).networkName,"onUpdate:modelValue":l[12]||(l[12]=e=>T(be).networkName=e),style:{width:"320px"},placeholder:"请选择镜像"},{default:q((()=>[(L(!0),O(K,null,J(T(Ce),(e=>(L(),D(Ne,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(Ee,{label:"端口"},{default:q((()=>[0===T(be).ports.length?(L(),O("span",ie,"可以添加端口绑定")):Q("",!0),(L(!0),O(K,null,J(T(be).ports,((e,l)=>(L(),D(Ee,{key:l,style:{"margin-bottom":"4px"}},{default:q((()=>[S(xe,{modelValue:e.hostPort,"onUpdate:modelValue":l=>e.hostPort=l,style:{width:"160px"},placeholder:"服务器端口"},null,8,["modelValue","onUpdate:modelValue"]),S(xe,{modelValue:e.containerPort,"onUpdate:modelValue":l=>e.containerPort=l,style:{width:"160px"},placeholder:"容器端口"},null,8,["modelValue","onUpdate:modelValue"]),S(t,{type:"danger",text:"",onClick:e=>(e=>{be.ports.splice(e,1)})(l)},{default:q((()=>[S(Ae,{"icon-class":"close"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),S(Ee,null,{default:q((()=>[S(t,{type:"primary",text:"",onClick:Ve},{default:q((()=>[M("添加端口"),S(Ae,{"icon-class":"plus"})])),_:1})])),_:1}),S(Ee,{label:"目录/文件挂载"},{default:q((()=>[0===T(be).volumes.length?(L(),O("span",re,"可以添加目录/文件挂载")):Q("",!0),(L(!0),O(K,null,J(T(be).volumes,((e,l)=>(L(),D(Ee,{key:l,style:{"margin-bottom":"4px"}},{default:q((()=>[S(xe,{modelValue:e.hostPath,"onUpdate:modelValue":l=>e.hostPath=l,style:{width:"200px"},placeholder:"服务器目录/文件"},null,8,["modelValue","onUpdate:modelValue"]),S(xe,{modelValue:e.containerPath,"onUpdate:modelValue":l=>e.containerPath=l,style:{width:"200px"},placeholder:"容器目录/文件"},null,8,["modelValue","onUpdate:modelValue"]),S(t,{type:"danger",text:"",onClick:e=>(e=>{be.volumes.splice(e,1)})(l)},{default:q((()=>[S(Ae,{"icon-class":"close"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),S(Ee,null,{default:q((()=>[S(t,{type:"primary",text:"",onClick:ze},{default:q((()=>[M(" 添加目录/文件挂载"),S(Ae,{"icon-class":"plus"})])),_:1})])),_:1}),S(Ee,{label:"标签(可选)"},{default:q((()=>[S(xe,{modelValue:T(be).labels,"onUpdate:modelValue":l[13]||(l[13]=e=>T(be).labels=e),type:"textarea",rows:4,placeholder:"一行一个，例如:\nkey1=value1\nkey2=value2"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),B("div",de,[S(t,{type:"default",size:"default",plain:"",onClick:l[14]||(l[14]=e=>_e.value=!1)},{default:q((()=>[M("取消")])),_:1}),R((L(),D(t,{type:"primary",size:"default",plain:"",onClick:Ue},{default:q((()=>[M(" 确定 ")])),_:1})),[[Be,T(Pe)]])])])),_:1},8,["modelValue"])])],64)}}}),[["__scopeId","data-v-d3e88004"]]);export{ue as default};

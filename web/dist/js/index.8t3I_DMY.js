var e=Object.defineProperty,l=(l,a,t)=>((l,a,t)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t)(l,"symbol"!=typeof a?a+"":a,t);import"./el-button.Bh3a0xQF.js";import{v as a}from"./el-loading.D6_9u1EB.js";import{E as t}from"./el-drawer.is6L0oK4.js";import{a as o,e as n,s}from"./message.DctIvaHE.js";import{a as r,E as i}from"./el-form-item.BDwFQHfq.js";import{_ as p}from"./index.DRsxk879.js";/* empty css               */import{E as u,a as d}from"./el-select.CX85AUQb.js";import"./el-popper.wQZhTUhG.js";import{E as m}from"./el-dialog.CC84_yNH.js";import{u as c,z as f,E as h,a as v}from"./zh-cn.B2KhLhgh.js";import{E as w,a as g}from"./el-table-column.412yn3sf.js";import"./el-tooltip.l0sNRNKZ.js";import{E as y,a as _,b as k}from"./el-dropdown-item.CPFkE0B0.js";import{E as b}from"./el-card.Dwv9l0RQ.js";import{a as x,c as V,q as j,s as C,d as z,r as U,e as P,f as N}from"./index.ChZW9-JR.js";import{d as E,y as $,o as q,r as A,x as B,k as I,f as O,m as S,w as T,u as R,X as K,F as L,a as M,A as W,e as X,b as D,t as F,P as G,i as H,_ as Y}from"./index.Dr9aOSLV.js";import{E as Z}from"./index.Dyk8l7ar.js";import{E as J}from"./index.1DI8xxX2.js";import{E as Q}from"./index.D9jSBXYG.js";import{E as ee}from"./index.Bjg9Z5Vi.js";import"./use-dialog.BrP1_dbF.js";import"./vnode._yyMxGkh.js";import"./event.BwRzfsZt.js";import"./use-form-item.CQAx4y3m.js";import"./index.BRGrvrSC.js";import"./scroll.BZMJFPW3.js";import"./focus-trap.ZmI0uCgZ.js";import"./castArray.DwF5sPJL.js";import"./_baseClone.CG0H6u9F.js";import"./_Uint8Array.DSxpQmA-.js";import"./_initCloneObject.u30XBX3X.js";import"./token.DWNpOE8r.js";import"./isEqual.qlKf3nEY.js";import"./refs.eEe29D1w.js";import"./index.nuX2YVwj.js";import"./aria.C-hsWcn7.js";import"./validator.nxW8Vyz9.js";class le{constructor(e,a=null,t=null,o=null,n=null){l(this,"url"),l(this,"ws"),l(this,"close"),l(this,"send");let s=window.location;e=s.host+"/"+e,this.url=/https/.test(s.protocol)?"wss://"+e:"ws://"+e,this.ws=new WebSocket(this.url),this.close=()=>{this.ws.close()},this.send=e=>{this.ws.send(e)},this.ws.onopen=e=>{null!==a&&a(this,e)},this.ws.onmessage=e=>{null!==t&&t(this,e)},this.ws.onerror=e=>{null!=o&&o(this,e)},this.ws.onclose=e=>{null!==n&&n(this,e)}}}const ae={class:"am-container-title"},te={class:"am-container-operator"},oe={class:"am-table"},ne={class:"am-pagination"},se={class:"dialog-footer"},re={class:"am-container-create"},ie={key:0},pe={key:0},ue={key:0},de={class:"am-container-create__operator"},me=Y(E({__name:"index",setup(e){const l=$();q((()=>{me(),Pe(),ze()}));const E={},{data:Y,refresh:me,loading:ce,pagination:fe}=c(j,{},{}),he=A(!1),ve=A(0),we=A("");let ge;const ye=()=>{he.value=!1,ge.close()},_e=()=>{ge.close()},ke=()=>{const e=document.createElement("a");e.setAttribute("href",`data:text/plain;charset=utf-8,${encodeURIComponent(we.value)}`),e.setAttribute("download","log.txt"),e.style.display="none",e.click()},be=A(!1),xe=A(),Ve=B({containerName:"",imageName:"",networkName:"",ports:[],volumes:[],environments:[],labels:""}),je=B({containerName:[{required:!0,message:"请输入容器名称",trigger:"blur"}],imageName:[{required:!0,message:"请选择镜像",trigger:"blur"}],networkName:[{required:!0,message:"请选择网络",trigger:"blur"}]}),Ce=A([]),ze=async()=>{const{data:e}=await x({page:1,size:100});l.app.setImages(e.data),Ce.value=e.data.map((e=>({value:e.name+":"+e.tag,label:e.name+":"+e.tag})))},Ue=A([]),Pe=async()=>{const{data:e}=await V({page:1,size:100});l.app.setNetworks(e.data),Ue.value=e.data.map((e=>({value:e.name,label:e.name})))},Ne=()=>{Ve.ports.push({hostPort:"",containerPort:""})},Ee=()=>{Ve.volumes.push({hostPath:"",containerPath:""})},$e=()=>{Ve.environments.push({key:"",value:""})},qe=A(!1);return(e,c)=>{const x=J,V=b,j=w,$=Q,q=y,A=_,B=k,ze=g,Pe=h,Ae=v,Be=ee,Ie=m,Oe=r,Se=d,Te=u,Re=p,Ke=i,Le=t,Me=a;return M(),I(L,null,[O("div",ae,[O("span",{onClick:c[0]||(c[0]=l=>e.$router.push("/docker/container"))},"容器"),O("span",{onClick:c[1]||(c[1]=l=>e.$router.push("/docker/image"))},"镜像"),O("span",{onClick:c[2]||(c[2]=l=>e.$router.push("/docker/network"))},"网络"),O("span",{onClick:c[3]||(c[3]=l=>e.$router.push("/docker/settings"))},"设置")]),O("div",te,[S(V,{shadow:"never"},{default:T((()=>[S(x,{type:"primary",plain:"",onClick:c[4]||(c[4]=e=>be.value=!0)},{default:T((()=>[W("创建容器")])),_:1})])),_:1})]),S(V,{shadow:"never"},{default:T((()=>[O("div",oe,[X((M(),D(ze,{data:R(Y),key:R(ve),stripe:"",ref:"multipleTable"},{default:T((()=>[S(j,{prop:"name",label:"容器名称",align:"center","min-width":"120","show-overflow-tooltip":"",fixed:"",sortable:""}),S(j,{prop:"image",label:"镜像名称",align:"center","min-width":"120","show-overflow-tooltip":"",sortable:""}),S(j,{prop:"ip",label:"容器 IP",align:"center","min-width":"100","show-overflow-tooltip":"",sortable:""}),S(j,{prop:"ports",label:"容器端口",align:"center","min-width":"100","show-overflow-tooltip":""}),S(j,{prop:"state",label:"运行状态",align:"center","min-width":"120","show-overflow-tooltip":""},{default:T((e=>[S($,{type:"running"===e.row.state?"success":"danger"},{default:T((()=>[W(F(e.row.state),1)])),_:2},1032,["type"])])),_:1}),S(j,{prop:"uptime",label:"启动时间",align:"center","min-width":"120","show-overflow-tooltip":"",sortable:""}),S(j,{prop:"cpu_percent",label:"CPU使用率",align:"center","min-width":"130","show-overflow-tooltip":"",sortable:""}),S(j,{prop:"memory_percent",label:"内存使用率",align:"center","min-width":"130","show-overflow-tooltip":"",sortable:""}),S(j,{prop:"memory_usage",label:"内存使用量",align:"center","min-width":"130","show-overflow-tooltip":"",sortable:""}),S(j,{prop:"memory_limit",label:"内存限制",align:"center","min-width":"120","show-overflow-tooltip":""}),S(j,{label:"操作",width:"200",fixed:"right",align:"center"},{default:T((e=>[S(x,{type:"primary",size:"small",text:"",onClick:l=>{return a=e.row.id,we.value="",he.value=!0,void(ge=new le("ws/"+a,((e,l)=>{e.send(a)}),((e,l)=>{we.value=we.value+"\n"+l.data})));var a}},{default:T((()=>[W(" 日志 ")])),_:2},1032,["onClick"]),S(x,{type:"primary",size:"small",text:"",onClick:l=>{return a=e.row.id,void C({container_id:a}).finally((()=>{me(),ve.value+=1}));var a}},{default:T((()=>[W(" 启动 ")])),_:2},1032,["onClick"]),S(B,null,{dropdown:T((()=>[S(A,null,{default:T((()=>[S(q,null,{default:T((()=>[S(x,{type:"warning",size:"small",text:"",onClick:l=>{return a=e.row.id,void z({container_id:a}).finally((()=>{me(),ve.value+=1}));var a}},{default:T((()=>[W(" 停止 ")])),_:2},1032,["onClick"])])),_:2},1024),S(q,null,{default:T((()=>[S(x,{type:"warning",size:"small",text:"",onClick:l=>{return a=e.row.id,void U({container_id:a}).finally((()=>{me(),ve.value+=1}));var a}},{default:T((()=>[W(" 重启 ")])),_:2},1032,["onClick"])])),_:2},1024),S(q,null,{default:T((()=>[S(x,{type:"danger",size:"small",text:"",onClick:l=>{return a=e.row.id,void Z.confirm("该操作会强制删除该容器. 继续吗?","警告",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning",beforeClose:(e,l,t)=>{"confirm"===e?(l.confirmButtonLoading=!0,P({container_id:a}).then((()=>{o({type:"success",message:"删除完成"})})).finally((()=>{l.confirmButtonLoading=!1,t(),me(),ve.value+=1}))):t()}}).then((()=>{})).catch((()=>{o({type:"info",message:"删除取消"})}));var a}},{default:T((()=>[W(" 删除 ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),default:T((()=>[S(x,{type:"primary",size:"small",text:""},{default:T((()=>[W("更多")])),_:1})])),_:2},1024)])),_:1})])),_:1},8,["data"])),[[Me,R(ce)]])]),O("div",ne,[S(Ae,{locale:R(f)},{default:T((()=>[S(Pe,{"current-page":R(fe).page,"onUpdate:currentPage":c[5]||(c[5]=e=>R(fe).page=e),"page-size":R(fe).size,layout:"total, sizes, prev, pager, next, jumper","page-sizes":R(fe).sizeOption,total:R(fe).total,onSizeChange:c[6]||(c[6]=e=>R(fe).onSizeChange(e,E)),onCurrentChange:c[7]||(c[7]=e=>R(fe).onPageChange(e,E))},null,8,["current-page","page-size","page-sizes","total"])])),_:1},8,["locale"])])])),_:1}),S(Ie,{modelValue:R(he),"onUpdate:modelValue":c[9]||(c[9]=e=>K(he)?he.value=e:null),title:"日志",width:"50%","before-close":ye},{footer:T((()=>[O("div",se,[S(x,{size:"small",type:"primary",plain:"",onClick:ke},{default:T((()=>[W("下载")])),_:1}),S(x,{size:"small",type:"info",plain:"",onClick:_e},{default:T((()=>[W("停止")])),_:1}),S(x,{size:"small",type:"success",plain:"",onClick:ye},{default:T((()=>[W("关闭")])),_:1})])])),default:T((()=>[S(Be,{modelValue:R(we),"onUpdate:modelValue":c[8]||(c[8]=e=>K(we)?we.value=e:null),rows:"20",type:"textarea"},null,8,["modelValue"])])),_:1},8,["modelValue"]),O("div",re,[S(Le,{modelValue:R(be),"onUpdate:modelValue":c[16]||(c[16]=e=>K(be)?be.value=e:null),size:"50%",title:"创建容器"},{default:T((()=>[S(Ke,{ref_key:"containerCreateRef",ref:xe,model:R(Ve),rules:R(je),"label-width":"120px","label-position":"left"},{default:T((()=>[S(Oe,{label:"名称",prop:"containerName"},{default:T((()=>[S(Be,{modelValue:R(Ve).containerName,"onUpdate:modelValue":c[10]||(c[10]=e=>R(Ve).containerName=e),placeholder:"请输入名称"},null,8,["modelValue"])])),_:1}),S(Oe,{label:"镜像",prop:"imageName"},{default:T((()=>[S(Te,{modelValue:R(Ve).imageName,"onUpdate:modelValue":c[11]||(c[11]=e=>R(Ve).imageName=e),style:{width:"320px"},placeholder:"请选择镜像"},{default:T((()=>[(M(!0),I(L,null,G(R(Ce),(e=>(M(),D(Se,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(Oe,{label:"网络",prop:"networkName"},{default:T((()=>[S(Te,{modelValue:R(Ve).networkName,"onUpdate:modelValue":c[12]||(c[12]=e=>R(Ve).networkName=e),style:{width:"320px"},placeholder:"请选择镜像"},{default:T((()=>[(M(!0),I(L,null,G(R(Ue),(e=>(M(),D(Se,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(Oe,{label:"端口",prop:"ports"},{default:T((()=>[0===R(Ve).ports.length?(M(),I("span",ie,"可以添加端口绑定")):H("",!0),(M(!0),I(L,null,G(R(Ve).ports,((e,l)=>(M(),D(Oe,{key:l,style:{"margin-bottom":"4px"}},{default:T((()=>[S(Be,{modelValue:e.hostPort,"onUpdate:modelValue":l=>e.hostPort=l,style:{width:"160px"},placeholder:"服务器端口"},null,8,["modelValue","onUpdate:modelValue"]),S(Be,{modelValue:e.containerPort,"onUpdate:modelValue":l=>e.containerPort=l,style:{width:"160px"},placeholder:"容器端口"},null,8,["modelValue","onUpdate:modelValue"]),S(x,{type:"danger",text:"",onClick:e=>(e=>{Ve.ports.splice(e,1)})(l)},{default:T((()=>[S(Re,{"icon-class":"close"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),S(Oe,null,{default:T((()=>[S(x,{type:"primary",text:"",onClick:Ne},{default:T((()=>[W("添加端口"),S(Re,{"icon-class":"plus"})])),_:1})])),_:1}),S(Oe,{label:"环境变量",prop:"environments"},{default:T((()=>[0===R(Ve).environments.length?(M(),I("span",pe,"可以添加环境变量")):H("",!0),(M(!0),I(L,null,G(R(Ve).environments,((e,l)=>(M(),D(Oe,{key:l,style:{"margin-bottom":"4px"}},{default:T((()=>[S(Be,{modelValue:e.key,"onUpdate:modelValue":l=>e.key=l,style:{width:"160px"},placeholder:"变量名"},null,8,["modelValue","onUpdate:modelValue"]),S(Be,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,style:{width:"160px"},placeholder:"变量值"},null,8,["modelValue","onUpdate:modelValue"]),S(x,{type:"danger",text:"",onClick:e=>(e=>{Ve.environments.splice(e,1)})(l)},{default:T((()=>[S(Re,{"icon-class":"close"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),S(Oe,null,{default:T((()=>[S(x,{type:"primary",text:"",onClick:$e},{default:T((()=>[W(" 添加环境变量 "),S(Re,{"icon-class":"plus"})])),_:1})])),_:1}),S(Oe,{label:"目录/文件挂载",prop:"volumes"},{default:T((()=>[0===R(Ve).volumes.length?(M(),I("span",ue,"可以添加目录/文件挂载")):H("",!0),(M(!0),I(L,null,G(R(Ve).volumes,((e,l)=>(M(),D(Oe,{key:l,style:{"margin-bottom":"4px"}},{default:T((()=>[S(Be,{modelValue:e.hostPath,"onUpdate:modelValue":l=>e.hostPath=l,style:{width:"200px"},placeholder:"服务器目录/文件"},null,8,["modelValue","onUpdate:modelValue"]),S(Be,{modelValue:e.containerPath,"onUpdate:modelValue":l=>e.containerPath=l,style:{width:"200px"},placeholder:"容器目录/文件"},null,8,["modelValue","onUpdate:modelValue"]),S(x,{type:"danger",text:"",onClick:e=>(e=>{Ve.volumes.splice(e,1)})(l)},{default:T((()=>[S(Re,{"icon-class":"close"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),S(Oe,null,{default:T((()=>[S(x,{type:"primary",text:"",onClick:Ee},{default:T((()=>[W(" 添加目录/文件挂载"),S(Re,{"icon-class":"plus"})])),_:1})])),_:1}),S(Oe,{label:"标签(可选)",prop:"labels"},{default:T((()=>[S(Be,{modelValue:R(Ve).labels,"onUpdate:modelValue":c[13]||(c[13]=e=>R(Ve).labels=e),type:"textarea",rows:4,placeholder:"一行一个，例如:\nkey1=value1\nkey2=value2"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),O("div",de,[S(x,{type:"default",size:"default",plain:"",onClick:c[14]||(c[14]=e=>be.value=!1)},{default:T((()=>[W("取消")])),_:1}),X((M(),D(x,{type:"primary",size:"default",plain:"",onClick:c[15]||(c[15]=e=>(async e=>{e&&await(null==e?void 0:e.validate(((e,a)=>{if(e){qe.value=!0;let e=[],a=[],t=[],o=new Map,r="",i="";for(let l=0;l<Ve.ports.length;l++)e.push(`${Ve.ports[l].hostPort}:${Ve.ports[l].containerPort}`);for(let l=0;l<Ve.volumes.length;l++)a.push(`${Ve.volumes[l].hostPath}:${Ve.volumes[l].containerPath}`);for(let l=0;l<Ve.environments.length;l++)t.push(`${Ve.environments[l].key}=${Ve.environments[l].value}`);if(Ve.labels){const e=Ve.labels.split("\n");for(let l=0;l<e.length;l++){const a=e[l].split(":");o.set(a[0],a[1])}}l.app.networks.filter((e=>e.name===Ve.networkName)).forEach((e=>{e.name==Ve.networkName&&(r=e.driver,i=e.id)}));const p={container_name:Ve.containerName,image_name:Ve.imageName,network_name:Ve.networkName,network_mode:r,network_id:i,ports:e,volumes:a,environments:t,labels:o};N(p).then((e=>{e.data,qe.value=!1,be.value=!1,s("容器创建成功"),me()})).catch((e=>{n(e),qe.value=!1}))}else n("请检查表单")})))})(R(xe)))},{default:T((()=>[W(" 确定 ")])),_:1})),[[Me,R(qe)]])])])),_:1},8,["modelValue"])])],64)}}}),[["__scopeId","data-v-4f533675"]]);export{me as default};

var e=Object.defineProperty,l=(l,a,t)=>((l,a,t)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t)(l,"symbol"!=typeof a?a+"":a,t);import"./el-button.wSr2vfOs.js";import{E as a,a as t,v as o}from"./el-table-column.CRjwOlSm.js";import{E as n}from"./el-drawer.QfBl6wA-.js";import{a as s,e as r,s as i}from"./message.bOUkP4cz.js";import{a as u,E as p}from"./el-form-item.Od_7DtX7.js";import{_ as d}from"./index.vFwLIVie.js";/* empty css               */import{E as m,a as c}from"./el-select.Djdc0_BA.js";import"./el-popper.B5lc-jMO.js";import{E as f}from"./el-dialog.QrPPJRCD.js";import{u as h,z as v,E as w,a as g}from"./zh-cn.DsjAtiY-.js";import"./el-tooltip.l0sNRNKZ.js";import{E as y,a as _,b}from"./el-dropdown-item.BwzSe7Kc.js";import{E as k}from"./el-card.qxUhNo9k.js";import{a as x,c as V,q as C,s as j,d as z,r as U,e as P,f as N}from"./index.BmMGee4z.js";import{d as E,y as $,o as q,r as A,x as I,k as O,f as B,m as S,w as T,u as L,Y as K,F as M,a as Q,A as R,e as D,b as F,t as G,Q as H,i as W,_ as Y}from"./index.C-XteKAQ.js";import{E as J}from"./index.BsLDvSMs.js";import{E as X}from"./index.BusDn2qi.js";import{E as Z}from"./index.BYpNppOK.js";import{E as ee}from"./index.W1JDYdlb.js";import"./index.HJW_Xvjo.js";import"./isEqual.Bn-GIEBR.js";import"./_Uint8Array.DhThSVct.js";import"./use-form-item.BHwM85F6.js";import"./_initCloneObject.A5AD6tfW.js";import"./use-dialog.0QHuDEHA.js";import"./vnode.DQET2EQQ.js";import"./scroll.COMsDKDo.js";import"./focus-trap.BwkBla3c.js";import"./castArray.DN6WFAt4.js";import"./_baseClone.BXZGK5jP.js";import"./refs.D6GIAKzc.js";import"./index.Bs0cFoC_.js";import"./aria.C-hsWcn7.js";class le{constructor(e,a=null,t=null,o=null,n=null){l(this,"url"),l(this,"ws"),l(this,"close"),l(this,"send");let s=window.location;e=s.host+"/"+e,this.url=/https/.test(s.protocol)?"wss://"+e:"ws://"+e,this.ws=new WebSocket(this.url),this.close=()=>{this.ws.close()},this.send=e=>{this.ws.send(e)},this.ws.onopen=e=>{null!==a&&a(this,e)},this.ws.onmessage=e=>{null!==t&&t(this,e)},this.ws.onerror=e=>{null!=o&&o(this,e)},this.ws.onclose=e=>{null!==n&&n(this,e)}}}const ae={class:"am-container-title"},te={class:"am-container-operator"},oe={class:"am-table"},ne={class:"am-pagination"},se={class:"dialog-footer"},re={class:"am-container-create"},ie={key:0},ue={key:0},pe={key:0},de={class:"am-container-create__operator"},me=Y(E({__name:"index",setup(e){const l=$();q((()=>{me(),Pe(),ze()}));const E={},{data:Y,refresh:me,loading:ce,pagination:fe}=h(C,{},{}),he=A(!1),ve=A(0),we=A("");let ge;const ye=()=>{he.value=!1,ge.close()},_e=()=>{ge.close()},be=()=>{const e=document.createElement("a");e.setAttribute("href",`data:text/plain;charset=utf-8,${encodeURIComponent(we.value)}`),e.setAttribute("download","log.txt"),e.style.display="none",e.click()},ke=A(!1),xe=A(),Ve=I({containerName:"",imageName:"",networkName:"",ports:[],volumes:[],environments:[],labels:""}),Ce=I({containerName:[{required:!0,message:"请输入容器名称",trigger:"blur"}],imageName:[{required:!0,message:"请选择镜像",trigger:"blur"}],networkName:[{required:!0,message:"请选择网络",trigger:"blur"}]}),je=A([]),ze=async()=>{const{data:e}=await x({page:1,size:100});l.app.setImages(e.data),je.value=e.data.map((e=>({value:e.name+":"+e.tag,label:e.name+":"+e.tag})))},Ue=A([]),Pe=async()=>{const{data:e}=await V({page:1,size:100});l.app.setNetworks(e.data),Ue.value=e.data.map((e=>({value:e.name,label:e.name})))},Ne=()=>{Ve.ports.push({hostPort:"",containerPort:""})},Ee=()=>{Ve.volumes.push({hostPath:"",containerPath:""})},$e=()=>{Ve.environments.push({key:"",value:""})},qe=A(!1);return(e,h)=>{const x=X,V=k,C=a,$=Z,q=y,A=_,I=b,ze=t,Pe=w,Ae=g,Ie=ee,Oe=f,Be=u,Se=c,Te=m,Le=d,Ke=p,Me=n,Qe=o;return Q(),O(M,null,[B("div",ae,[B("span",{onClick:h[0]||(h[0]=l=>e.$router.push("/docker/container"))},"容器"),B("span",{onClick:h[1]||(h[1]=l=>e.$router.push("/docker/image"))},"镜像"),B("span",{onClick:h[2]||(h[2]=l=>e.$router.push("/docker/network"))},"网络"),B("span",{onClick:h[3]||(h[3]=l=>e.$router.push("/docker/settings"))},"设置")]),B("div",te,[S(V,{shadow:"never"},{default:T((()=>[S(x,{type:"primary",plain:"",onClick:h[4]||(h[4]=e=>ke.value=!0)},{default:T((()=>[R("创建容器")])),_:1})])),_:1})]),S(V,{shadow:"never"},{default:T((()=>[B("div",oe,[D((Q(),F(ze,{data:L(Y),key:L(ve),stripe:"",ref:"multipleTable"},{default:T((()=>[S(C,{prop:"id",label:"容器 ID","min-width":"100",align:"center",fixed:"",sortable:""}),S(C,{prop:"name",label:"容器名称",align:"center","min-width":"120","show-overflow-tooltip":"",fixed:"",sortable:""}),S(C,{prop:"image",label:"镜像名称",align:"center","min-width":"120","show-overflow-tooltip":"",sortable:""}),S(C,{prop:"ip",label:"容器 IP",align:"center","min-width":"100","show-overflow-tooltip":"",sortable:""}),S(C,{prop:"ports",label:"容器端口",align:"center","min-width":"100","show-overflow-tooltip":""}),S(C,{prop:"state",label:"运行状态",align:"center","min-width":"120","show-overflow-tooltip":""},{default:T((e=>[S($,{type:"running"===e.row.state?"success":"danger"},{default:T((()=>[R(G(e.row.state),1)])),_:2},1032,["type"])])),_:1}),S(C,{prop:"uptime",label:"启动时间",align:"center","min-width":"120","show-overflow-tooltip":"",sortable:""}),S(C,{prop:"cpu_percent",label:"CPU使用率",align:"center","min-width":"130","show-overflow-tooltip":"",sortable:""}),S(C,{prop:"memory_percent",label:"内存使用率",align:"center","min-width":"130","show-overflow-tooltip":"",sortable:""}),S(C,{prop:"memory_usage",label:"内存使用量",align:"center","min-width":"130","show-overflow-tooltip":"",sortable:""}),S(C,{prop:"memory_limit",label:"内存限制",align:"center","min-width":"120","show-overflow-tooltip":""}),S(C,{label:"操作",width:"200",fixed:"right",align:"center"},{default:T((e=>[S(x,{type:"primary",size:"small",text:"",onClick:l=>{return a=e.row.id,we.value="",he.value=!0,void(ge=new le("ws/"+a,((e,l)=>{e.send(a)}),((e,l)=>{we.value=we.value+"\n"+l.data})));var a}},{default:T((()=>[R(" 日志 ")])),_:2},1032,["onClick"]),S(x,{type:"primary",size:"small",text:"",onClick:l=>{return a=e.row.id,void j({container_id:a}).finally((()=>{me(),ve.value+=1}));var a}},{default:T((()=>[R(" 启动 ")])),_:2},1032,["onClick"]),S(I,null,{dropdown:T((()=>[S(A,null,{default:T((()=>[S(q,null,{default:T((()=>[S(x,{type:"warning",size:"small",text:"",onClick:l=>{return a=e.row.id,void z({container_id:a}).finally((()=>{me(),ve.value+=1}));var a}},{default:T((()=>[R(" 停止 ")])),_:2},1032,["onClick"])])),_:2},1024),S(q,null,{default:T((()=>[S(x,{type:"warning",size:"small",text:"",onClick:l=>{return a=e.row.id,void U({container_id:a}).finally((()=>{me(),ve.value+=1}));var a}},{default:T((()=>[R(" 重启 ")])),_:2},1032,["onClick"])])),_:2},1024),S(q,null,{default:T((()=>[S(x,{type:"danger",size:"small",text:"",onClick:l=>{return a=e.row.id,void J.confirm("该操作会强制删除该容器. 继续吗?","警告",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning",beforeClose:(e,l,t)=>{"confirm"===e?(l.confirmButtonLoading=!0,P({container_id:a}).then((()=>{s({type:"success",message:"删除完成"})})).finally((()=>{l.confirmButtonLoading=!1,t(),me(),ve.value+=1}))):t()}}).then((()=>{})).catch((()=>{s({type:"info",message:"删除取消"})}));var a}},{default:T((()=>[R(" 删除 ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),default:T((()=>[S(x,{type:"primary",size:"small",text:""},{default:T((()=>[R("更多")])),_:1})])),_:2},1024)])),_:1})])),_:1},8,["data"])),[[Qe,L(ce)]])]),B("div",ne,[S(Ae,{locale:L(v)},{default:T((()=>[S(Pe,{"current-page":L(fe).page,"onUpdate:currentPage":h[5]||(h[5]=e=>L(fe).page=e),"page-size":L(fe).size,layout:"total, sizes, prev, pager, next, jumper","page-sizes":L(fe).sizeOption,total:L(fe).total,onSizeChange:h[6]||(h[6]=e=>L(fe).onSizeChange(e,E)),onCurrentChange:h[7]||(h[7]=e=>L(fe).onPageChange(e,E))},null,8,["current-page","page-size","page-sizes","total"])])),_:1},8,["locale"])])])),_:1}),S(Oe,{modelValue:L(he),"onUpdate:modelValue":h[9]||(h[9]=e=>K(he)?he.value=e:null),title:"日志",width:"50%","before-close":ye},{footer:T((()=>[B("div",se,[S(x,{size:"small",type:"primary",plain:"",onClick:be},{default:T((()=>[R("下载")])),_:1}),S(x,{size:"small",type:"info",plain:"",onClick:_e},{default:T((()=>[R("停止")])),_:1}),S(x,{size:"small",type:"success",plain:"",onClick:ye},{default:T((()=>[R("关闭")])),_:1})])])),default:T((()=>[S(Ie,{modelValue:L(we),"onUpdate:modelValue":h[8]||(h[8]=e=>K(we)?we.value=e:null),rows:"20",type:"textarea"},null,8,["modelValue"])])),_:1},8,["modelValue"]),B("div",re,[S(Me,{modelValue:L(ke),"onUpdate:modelValue":h[16]||(h[16]=e=>K(ke)?ke.value=e:null),size:"50%",title:"创建容器"},{default:T((()=>[S(Ke,{ref_key:"containerCreateRef",ref:xe,model:L(Ve),rules:L(Ce),"label-width":"120px","label-position":"left"},{default:T((()=>[S(Be,{label:"名称",prop:"containerName"},{default:T((()=>[S(Ie,{modelValue:L(Ve).containerName,"onUpdate:modelValue":h[10]||(h[10]=e=>L(Ve).containerName=e),placeholder:"请输入名称"},null,8,["modelValue"])])),_:1}),S(Be,{label:"镜像",prop:"imageName"},{default:T((()=>[S(Te,{modelValue:L(Ve).imageName,"onUpdate:modelValue":h[11]||(h[11]=e=>L(Ve).imageName=e),style:{width:"320px"},placeholder:"请选择镜像"},{default:T((()=>[(Q(!0),O(M,null,H(L(je),(e=>(Q(),F(Se,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(Be,{label:"网络",prop:"networkName"},{default:T((()=>[S(Te,{modelValue:L(Ve).networkName,"onUpdate:modelValue":h[12]||(h[12]=e=>L(Ve).networkName=e),style:{width:"320px"},placeholder:"请选择镜像"},{default:T((()=>[(Q(!0),O(M,null,H(L(Ue),(e=>(Q(),F(Se,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(Be,{label:"端口",prop:"ports"},{default:T((()=>[0===L(Ve).ports.length?(Q(),O("span",ie,"可以添加端口绑定")):W("",!0),(Q(!0),O(M,null,H(L(Ve).ports,((e,l)=>(Q(),F(Be,{key:l,style:{"margin-bottom":"4px"}},{default:T((()=>[S(Ie,{modelValue:e.hostPort,"onUpdate:modelValue":l=>e.hostPort=l,style:{width:"160px"},placeholder:"服务器端口"},null,8,["modelValue","onUpdate:modelValue"]),S(Ie,{modelValue:e.containerPort,"onUpdate:modelValue":l=>e.containerPort=l,style:{width:"160px"},placeholder:"容器端口"},null,8,["modelValue","onUpdate:modelValue"]),S(x,{type:"danger",text:"",onClick:e=>(e=>{Ve.ports.splice(e,1)})(l)},{default:T((()=>[S(Le,{"icon-class":"close"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),S(Be,null,{default:T((()=>[S(x,{type:"primary",text:"",onClick:Ne},{default:T((()=>[R("添加端口"),S(Le,{"icon-class":"plus"})])),_:1})])),_:1}),S(Be,{label:"环境变量",prop:"environments"},{default:T((()=>[0===L(Ve).environments.length?(Q(),O("span",ue,"可以添加环境变量")):W("",!0),(Q(!0),O(M,null,H(L(Ve).environments,((e,l)=>(Q(),F(Be,{key:l,style:{"margin-bottom":"4px"}},{default:T((()=>[S(Ie,{modelValue:e.key,"onUpdate:modelValue":l=>e.key=l,style:{width:"160px"},placeholder:"变量名"},null,8,["modelValue","onUpdate:modelValue"]),S(Ie,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,style:{width:"160px"},placeholder:"变量值"},null,8,["modelValue","onUpdate:modelValue"]),S(x,{type:"danger",text:"",onClick:e=>(e=>{Ve.environments.splice(e,1)})(l)},{default:T((()=>[S(Le,{"icon-class":"close"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),S(Be,null,{default:T((()=>[S(x,{type:"primary",text:"",onClick:$e},{default:T((()=>[R(" 添加环境变量 "),S(Le,{"icon-class":"plus"})])),_:1})])),_:1}),S(Be,{label:"目录/文件挂载",prop:"volumes"},{default:T((()=>[0===L(Ve).volumes.length?(Q(),O("span",pe,"可以添加目录/文件挂载")):W("",!0),(Q(!0),O(M,null,H(L(Ve).volumes,((e,l)=>(Q(),F(Be,{key:l,style:{"margin-bottom":"4px"}},{default:T((()=>[S(Ie,{modelValue:e.hostPath,"onUpdate:modelValue":l=>e.hostPath=l,style:{width:"200px"},placeholder:"服务器目录/文件"},null,8,["modelValue","onUpdate:modelValue"]),S(Ie,{modelValue:e.containerPath,"onUpdate:modelValue":l=>e.containerPath=l,style:{width:"200px"},placeholder:"容器目录/文件"},null,8,["modelValue","onUpdate:modelValue"]),S(x,{type:"danger",text:"",onClick:e=>(e=>{Ve.volumes.splice(e,1)})(l)},{default:T((()=>[S(Le,{"icon-class":"close"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),S(Be,null,{default:T((()=>[S(x,{type:"primary",text:"",onClick:Ee},{default:T((()=>[R(" 添加目录/文件挂载"),S(Le,{"icon-class":"plus"})])),_:1})])),_:1}),S(Be,{label:"标签(可选)",prop:"labels"},{default:T((()=>[S(Ie,{modelValue:L(Ve).labels,"onUpdate:modelValue":h[13]||(h[13]=e=>L(Ve).labels=e),type:"textarea",rows:4,placeholder:"一行一个，例如:\nkey1=value1\nkey2=value2"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),B("div",de,[S(x,{type:"default",size:"default",plain:"",onClick:h[14]||(h[14]=e=>ke.value=!1)},{default:T((()=>[R("取消")])),_:1}),D((Q(),F(x,{type:"primary",size:"default",plain:"",onClick:h[15]||(h[15]=e=>(async e=>{e&&await(null==e?void 0:e.validate(((e,a)=>{if(e){qe.value=!0;let e=[],a=[],t=[],o=new Map,n="",s="";for(let l=0;l<Ve.ports.length;l++)e.push(`${Ve.ports[l].hostPort}:${Ve.ports[l].containerPort}`);for(let l=0;l<Ve.volumes.length;l++)a.push(`${Ve.volumes[l].hostPath}:${Ve.volumes[l].containerPath}`);for(let l=0;l<Ve.environments.length;l++)t.push(`${Ve.environments[l].key}=${Ve.environments[l].value}`);if(Ve.labels){const e=Ve.labels.split("\n");for(let l=0;l<e.length;l++){const a=e[l].split(":");o.set(a[0],a[1])}}l.app.networks.filter((e=>e.name===Ve.networkName)).forEach((e=>{e.name==Ve.networkName&&(n=e.driver,s=e.id)}));const u={container_name:Ve.containerName,image_name:Ve.imageName,network_name:Ve.networkName,network_mode:n,network_id:s,ports:e,volumes:a,environments:t,labels:o};N(u).then((e=>{e.data,qe.value=!1,ke.value=!1,i("容器创建成功"),me()})).catch((e=>{r(e),qe.value=!1}))}else r("请检查表单")})))})(L(xe)))},{default:T((()=>[R(" 确定 ")])),_:1})),[[Qe,L(qe)]])])])),_:1},8,["modelValue"])])],64)}}}),[["__scopeId","data-v-a9b9abdc"]]);export{me as default};
